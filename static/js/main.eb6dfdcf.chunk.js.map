{"version":3,"sources":["UI/InteractionLayer.js","UI/Penslider.js","UI/Saturationslider.js","UI/Checkbox.js","UI/Colorpicker.js","UI/UserInterface.js","canvas/Topruler.js","canvas/Sideruler.js","canvas/Drawingsample.js","canvas/Canvas.js","history/Historybar.js","history/Historyselector.js","history/Button.js","svg/Timestroke.svg","Topbar.js","App.js","serviceWorker.js","reducers/rootreducer.js","index.js"],"names":["InteractionLayer","props","state","pointertrace","changes","pendown","canvRef","React","createRef","getSize","interpretTraceEl","e","button","offsetTop","this","current","parentElement","setState","x","clientX","y","clientY","getContext","beginPath","addTrace","clearRect","deltrace","dist","i","displaytraces","length","temp","traces","find","el","t","type","trace","j","newdist","Math","pow","delTrace","ctx","change","slice","moveTo","strokeStyle","uicolor","lineTo","stroke","tmp","drawtrace","alpha","id","ref","height","width","onContextMenu","preventDefault","onPointerDown","pointerDownHandler","bind","onPointerUp","pointerUpHandler","onPointerMove","pointerMoveHandler","Component","connect","ownProps","penstate","dispatch","clrDisplaytrace","Penslider","status","sliderpos","heigth","renderCanvas","fillStyle","title","arc","PI","fill","lineWidth","img","Image","onload","drawImage","className","Saturationslider","font","fillText","grad","createLinearGradient","hsl","hexToHSL","color","addColorStop","HSLToHex","h","l","fillRect","strokeRect","H","r","g","b","cmin","min","cmax","max","delta","round","s","abs","toFixed","c","m","toString","Checkbox","isChecked","setLineDash","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","bezierCurveTo","Colorpicker","firstChild","console","log","imgData","createImageData","saturation","pos","rgb","hslToRgb","data","putImageData","hue2rgb","p","q","setColor","UserInterface","colorpos","divRef","document","getElementById","clientHeight","clientWidth","nextSibling","delx","dely","lineJoin","rect","traceels","p1","p2","checkboxes","querySelector","childNodes","checkbox","offsetLeft","inBox","setCheckbox","val","record","sliders","slider","intersects","hex","setPenstate","colorpicker","getImageData","rgbToHex","p3","p4","det","gamma","lambda","a","d","x1","y1","x2","y2","update","Topruler","barRef","svgel","animVal","value","drawRuler","canvwidth","elstart","removeChild","floor","newElement","createElementNS","setAttribute","style","strokeWidth","appendChild","newText","setAttributeNS","innerHTML","Sideruler","canvheight","Drawingsample","getColor","getPoint","linedash","sampleTrace","end","lineCap","shadow","line","newcolor","point","Canvas","transform","moveref","containerheight","containerwidth","lastChild","textAlign","textBaseline","indexT","indexImg","deltaT","imageplacement","spiralMode","history","spiralRef","spiralCounter","ind","refX","refY","refWidth","imgwidth","refHeight","imgheight","shadowpenstate","initpenstate","f1","f2","displayHandlers","hideHandlers","drawalltraces","display","top","left","mid","vecA","diff","vecB","valA","valB","acos","tl","getBoundingClientRect","tr","bl","br","right","bottom","addImageTrace","offsetX","offsetY","dWidth","dHeight","dX","dY","angle","angleDiff","isNaN","setDeltaT","spiralTempT","matrix","file","target","files","alert","reader","FileReader","createElement","src","w","addthis","addEventListener","result","placeImage","readAsDataURL","addImage","name","onChange","for","image","imagetrace","Historybar","numOfEls","pentrace","selected","temptrace","selectedtraces","filter","uitracelist","getUItraceList","canvas","text","Array","from","Object","keys","k","printtext","drawHistory","event","interpretTrace","map","setDisplaytraces","arr","uitrace","push","onPointerOut","pointerOutHandler","setInit","addDisplaytrace","list","clrDisplaytraces","Historyselector","selectedOption","setHistory","drawComponent","cos","sin","changeEvent","Button","handleInputChange","checked","historybox","_extends","assign","arguments","source","key","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref","svgRef","viewBox","xmlSpace","fillRule","clipRule","strokeLinecap","strokeLinejoin","strokeMiterlimit","ForwardRef","forwardRef","fontSpecs","fontFamily","undefined","fontSize","fontStyle","fontWeight","Topbar","App","History","Historyoverlay","keyDownHandler","ctrlKey","undo","redo","onClick","xmlns","version","stroke-width","fill-rule","font-size","font-weight","font-family","Boolean","window","location","hostname","match","initState","clearTraces","getPenState","rootReducer","newtraces","action","newT","newdisplaytraces","store","createStore","ReactDOM","render","StrictMode","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.eb6dfdcf.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\n\r\n\r\nclass InteractionLayer extends Component {\r\n  state = {\r\n    pointertrace: [],\r\n    changes: {},\r\n    pendown: false,\r\n  }\r\n\r\n  constructor(props){\r\n      super(props);\r\n      this.canvRef = React.createRef();\r\n      this.getSize = props.getSize;\r\n      this.interpretTraceEl = props.interpretTraceEl\r\n  }\r\n\r\n  pointerDownHandler(e) {\r\n    //console.log(e.button);\r\n    if(e.button===5 || e.button===2){\r\n      return}\r\n    //console.log(e, this)\r\n    var offsetTop = this.canvRef.current.parentElement.offsetTop;\r\n    this.setState({\r\n      pendown: true,\r\n      pointertrace: [{x: e.clientX, y: e.clientY - offsetTop}]\r\n    })\r\n\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n\r\n    ctx.beginPath();\r\n  }\r\n\r\n  pointerUpHandler(e) {\r\n    if(e.button===5 || e.button===2){\r\n      this.setState({\r\n        pendown: false,\r\n        pointertrace: [],\r\n        changes: {}\r\n      })\r\n      var deltrace = null;\r\n      var dist = 25;\r\n      for(var i = 0; i < this.props.displaytraces.length; i++){\r\n        var temp = this.props.traces.find(el => el.t === this.props.displaytraces[i].t && el.type === \"ui\")\r\n        if(temp){\r\n          var trace = temp.trace;\r\n        } else {\r\n          continue;\r\n        }\r\n        var t = temp.t;\r\n        for(var j = 0; j < trace.length; j++){\r\n          var newdist = Math.pow(Math.pow((trace[j].x - e.clientX),2) + Math.pow((trace[j].y - e.clientY + 40),2),.5)\r\n          if(newdist < dist){\r\n            \r\n            deltrace = t;\r\n            dist = newdist;\r\n          }\r\n        }\r\n      }\r\n      if(deltrace !== null){\r\n        this.props.delTrace(deltrace)\r\n      }\r\n      return\r\n    }\r\n    this.props.addTrace(this.state.pointertrace, this.state.changes);\r\n    this.setState({\r\n      pendown: false,\r\n      pointertrace: [],\r\n      changes: {},\r\n    })\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n  }\r\n\r\n  pointerMoveHandler(e) {\r\n    if(e.button===5 || e.button===2){\r\n      return}\r\n    if (this.state.pendown) {\r\n      var offsetTop = this.canvRef.current.parentElement.offsetTop;\r\n      this.setState({\r\n        pointertrace: [...this.state.pointertrace, {x: e.clientX, y: e.clientY - offsetTop}]\r\n      })\r\n      const ctx = this.canvRef.current.getContext('2d');\r\n\r\n      var change = this.interpretTraceEl(this.state.pointertrace.slice(-2))\r\n      if(change){\r\n        this.setState({ \r\n          changes : {...this.state.changes, ...change}\r\n        })\r\n      }\r\n\r\n\r\n      ctx.moveTo(this.state.pointertrace[this.state.pointertrace.length-1].x, this.state.pointertrace[this.state.pointertrace.length-1].y);\r\n      ctx.strokeStyle = this.props.uicolor\r\n      ctx.lineTo(e.clientX, e.clientY-offsetTop);\r\n      ctx.stroke(); \r\n    }\r\n  }\r\n\r\n  componentDidUpdate(){\r\n    if(!this.state.pendown){\r\n      this.displaytraces();\r\n    }\r\n  }\r\n\r\n  displaytraces(){\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n    for(var i = 0; i < this.props.displaytraces.length; i++){\r\n      var tmp = this.props.traces.find(el => el.t === this.props.displaytraces[i].t && el.type === \"ui\")\r\n      if(tmp){\r\n        this.drawtrace(ctx, tmp.trace, this.props.displaytraces[i].alpha);\r\n      }\r\n    }\r\n  }\r\n\r\n  drawtrace(ctx, trace, alpha){\r\n    ctx.strokeStyle = \"rgba(255, 255, 255, \" + alpha + \")\";\r\n    ctx.beginPath();\r\n    ctx.moveTo(trace[0].x, trace[0].y);\r\n\r\n    for(var i = 1; i < trace.length; i++){\r\n      ctx.lineTo(trace[i].x,trace[i].y);\r\n    }\r\n    ctx.stroke();\r\n  }\r\n\r\n  render() {\r\n    //console.log(this.props);\r\n    return (\r\n        <canvas id=\"interactionlayer\" \r\n        ref={this.canvRef} \r\n        height={this.getSize().y} \r\n        width={this.getSize().x} \r\n        onContextMenu={(e)=>  {e.preventDefault(); return false;}}\r\n        onPointerDown={this.pointerDownHandler.bind(this)} \r\n        onPointerUp={this.pointerUpHandler.bind(this)} \r\n        onPointerMove={this.pointerMoveHandler.bind(this)}\r\n        />\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n    traces: state.traces,\r\n    penstate: state.penstate,\r\n    displaytraces: state.displaytraces,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    addTrace: (pointertrace, changes) => { dispatch({type: 'ADD_UITRACE', trace: pointertrace, changes: changes}) },\r\n    delTrace: (t) => { dispatch({type: 'DEL_UITRACE', t: t}) },\r\n    clrDisplaytrace: () => { dispatch({type: 'CLR_DISPLAYTRACE'}) },\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(InteractionLayer);\r\n","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\n\r\n\r\nclass Penslider extends Component {\r\n  status = {\r\n      sliderpos: 0\r\n  }\r\n\r\n  constructor(props){\r\n      super(props);\r\n      this.canvRef = React.createRef();\r\n  }\r\n  componentDidMount(){\r\n    this.setState({\r\n        width: this.props.width,\r\n        heigth: this.props.height,\r\n        sliderpos: 0\r\n    })\r\n  }\r\n\r\n  componentDidUpdate(){\r\n      this.renderCanvas()\r\n  }\r\n\r\n  renderCanvas(){\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    ctx.clearRect(0, 0, this.props.width, this.props.height);\r\n\r\n    ctx.fillStyle = this.props.uicolor;\r\n    ctx.strokeStyle = this.props.uicolor\r\n    //title\r\n    // ctx.font = \"15px Tahoma\";\r\n    // ctx.fillStyle = this.props.uicolor;\r\n    // ctx.fillText(this.props.title, 0, 30);\r\n    if(this.props.title === 'point'){\r\n      ctx.beginPath();\r\n      ctx.arc(11, 25, 10, 0, 2*Math.PI)\r\n      ctx.fill()\r\n    } \r\n    else if(this.props.title === 'alpha'){\r\n      ctx.lineWidth = 2;\r\n      ctx.beginPath();\r\n      ctx.arc(11, 25, 10, 0, Math.PI)\r\n      ctx.fill()\r\n      ctx.moveTo(11,10)\r\n      ctx.arc(11, 25, 10, -Math.PI/4, Math.PI * 5 / 4)\r\n      ctx.lineTo(11,10)\r\n      ctx.stroke()\r\n    } \r\n\r\n    ctx.lineWidth = 1;\r\n\r\n    var img = new Image();\r\n    img.onload = function() {\r\n      ctx.drawImage(img, 0, 0);\r\n    }\r\n    img.height = 40;\r\n    img.width = 40;\r\n\r\n    //sliderline\r\n    ctx.beginPath();\r\n\r\n    ctx.moveTo(50, 25);\r\n    ctx.lineTo(320, 25);\r\n    ctx.stroke(); \r\n\r\n    //slider\r\n    ctx.beginPath();\r\n    ctx.lineWidth = 3;\r\n    ctx.moveTo( 50 + this.props.penstate[this.props.title]*270, 10);\r\n    ctx.lineTo( 50 + this.props.penstate[this.props.title]*270, 40);\r\n    ctx.stroke();\r\n  }\r\n\r\n\r\n  render() {\r\n    return (\r\n      <canvas id={this.props.title} ref={this.canvRef} className=\"slider\" height={this.props.height} width={this.props.width*.8 + 3}/>\r\n    );\r\n  }\r\n}\r\n\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        penstate: state.penstate,\r\n    }\r\n  }\r\n  \r\n  export default connect(mapStateToProps)(Penslider);\r\n  ","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\n\r\n\r\nclass Saturationslider extends Component {\r\n  status = {\r\n      sliderpos: 0\r\n  }\r\n\r\n  constructor(props){\r\n      super(props);\r\n      this.canvRef = React.createRef();\r\n  }\r\n  componentDidMount(){\r\n    this.setState({\r\n        width: this.props.width,\r\n        heigth: this.props.height,\r\n        sliderpos: 0\r\n    })\r\n  }\r\n\r\n  componentDidUpdate(){\r\n      this.renderCanvas()\r\n      //console.log(this.props.penstate)\r\n  }\r\n\r\n  renderCanvas(){\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    ctx.clearRect(0, 0, this.props.width, this.props.height);\r\n\r\n    ctx.lineWidth = 1;\r\n    //title\r\n    ctx.font = \"15px Tahoma\";\r\n    ctx.fillStyle = this.props.uicolor;\r\n    if(this.props.title.length > 5){\r\n        ctx.fillText(this.props.title.slice(0,5) + \".\", 0, 30)\r\n    }\r\n    else{\r\n        ctx.fillText(this.props.title, 0, 30);\r\n    }\r\n\r\n    var img = new Image();\r\n    img.onload = function() {\r\n      ctx.drawImage(img, 0, 0);\r\n    }\r\n    img.height = 40;\r\n    img.width = 40;\r\n\r\n    //sliderline\r\n    ctx.beginPath()\r\n    var grad = ctx.createLinearGradient(50, 0, 320, 0);\r\n\r\n    var hsl = this.hexToHSL(this.props.penstate.color);\r\n\r\n    grad.addColorStop(0, this.HSLToHex(hsl.h, 0 , hsl.l));     //\r\n    grad.addColorStop(1, this.HSLToHex(hsl.h, 100, hsl.l));   //\r\n\r\n    ctx.fillStyle = grad;\r\n    // show the whole gradient\r\n    ctx.fillRect(50, 23, 270, 4);\r\n    // OP's square\r\n    ctx.strokeRect(100, 100, 100, 100);\r\n\r\n    ctx.stroke();\r\n\r\n    ctx.strokeStyle = this.props.uicolor;\r\n    ctx.beginPath()\r\n\r\n    //slider\r\n    ctx.lineWidth = 3;\r\n    ctx.moveTo( 50 + this.props.penstate[this.props.title]*270, 10);\r\n    ctx.lineTo( 50 + this.props.penstate[this.props.title]*270, 40);\r\n    ctx.stroke();\r\n\r\n\r\n  }\r\n\r\n  hexToHSL(H) {\r\n    // Convert hex to RGB first\r\n    let r = 0, g = 0, b = 0;\r\n    if (H.length === 4) {\r\n      r = \"0x\" + H[1] + H[1];\r\n      g = \"0x\" + H[2] + H[2];\r\n      b = \"0x\" + H[3] + H[3];\r\n    } else if (H.length === 7) {\r\n      r = \"0x\" + H[1] + H[2];\r\n      g = \"0x\" + H[3] + H[4];\r\n      b = \"0x\" + H[5] + H[6];\r\n    }\r\n    // Then to HSL\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    let cmin = Math.min(r,g,b),\r\n        cmax = Math.max(r,g,b),\r\n        delta = cmax - cmin,\r\n        h = 0,\r\n        s = 0,\r\n        l = 0;\r\n  \r\n    if (delta === 0)\r\n      h = 0;\r\n    else if (cmax === r)\r\n      h = ((g - b) / delta) % 6;\r\n    else if (cmax === g)\r\n      h = (b - r) / delta + 2;\r\n    else\r\n      h = (r - g) / delta + 4;\r\n  \r\n    h = Math.round(h * 60);\r\n  \r\n    if (h < 0)\r\n      h += 360;\r\n  \r\n    l = (cmax + cmin) / 2;\r\n    s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\r\n    s = +(s * 100).toFixed(1);\r\n    l = +(l * 100).toFixed(1);\r\n  \r\n    return {h,s,l};\r\n  }\r\n\r\n  HSLToHex(h,s,l) {\r\n    s /= 100;\r\n    l /= 100;\r\n  \r\n    let c = (1 - Math.abs(2 * l - 1)) * s,\r\n        x = c * (1 - Math.abs((h / 60) % 2 - 1)),\r\n        m = l - c/2,\r\n        r = 0,\r\n        g = 0,\r\n        b = 0;\r\n  \r\n    if (0 <= h && h < 60) {\r\n      r = c; g = x; b = 0;\r\n    } else if (60 <= h && h < 120) {\r\n      r = x; g = c; b = 0;\r\n    } else if (120 <= h && h < 180) {\r\n      r = 0; g = c; b = x;\r\n    } else if (180 <= h && h < 240) {\r\n      r = 0; g = x; b = c;\r\n    } else if (240 <= h && h < 300) {\r\n      r = x; g = 0; b = c;\r\n    } else if (300 <= h && h < 360) {\r\n      r = c; g = 0; b = x;\r\n    }\r\n    // Having obtained RGB, convert channels to hex\r\n    r = Math.round((r + m) * 255).toString(16);\r\n    g = Math.round((g + m) * 255).toString(16);\r\n    b = Math.round((b + m) * 255).toString(16);\r\n  \r\n    // Prepend 0s, if necessary\r\n    if (r.length === 1)\r\n      r = \"0\" + r;\r\n    if (g.length === 1)\r\n      g = \"0\" + g;\r\n    if (b.length === 1)\r\n      b = \"0\" + b;\r\n  \r\n    return \"#\" + r + g + b;\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n    return (\r\n\r\n          <canvas id={this.props.title} ref={this.canvRef} className=\"slider\" height={this.props.height} width={this.props.width*.8 + 3}/>\r\n    );\r\n  }\r\n}\r\n\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        penstate: state.penstate,\r\n        displaytraces: state.displaytraces\r\n    }\r\n  }\r\n  \r\n  export default connect(mapStateToProps)(Saturationslider);\r\n  ","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nclass Checkbox extends Component{\r\n\r\n    state = {\r\n        isChecked: false\r\n    }\r\n  \r\n    constructor(props){\r\n        super(props);\r\n        this.canvRef = React.createRef();\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        this.renderCanvas()\r\n    }\r\n  \r\n    renderCanvas(){\r\n      const ctx = this.canvRef.current.getContext('2d');\r\n      ctx.clearRect(0, 0, this.props.width, this.props.height);\r\n  \r\n\r\n      if (this.props.title === 'linedash'){\r\n        ctx.strokeStyle = this.props.uicolor;\r\n        ctx.lineWidth = 3;\r\n        ctx.setLineDash([3, 3]);\r\n        ctx.beginPath();\r\n        ctx.moveTo(40,20);\r\n        ctx.lineTo(90,20);\r\n        ctx.stroke();\r\n\r\n      } \r\n      else if (this.props.title === 'end'){\r\n        ctx.strokeStyle = this.props.uicolor;\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        ctx.moveTo(40,30);\r\n        ctx.lineTo(70,30);\r\n        ctx.moveTo(40,10);\r\n        ctx.lineTo(70,10);\r\n        ctx.arc(70, 20, 10, Math.PI*3/2, Math.PI/2)\r\n        ctx.moveTo(40,20);\r\n        ctx.lineTo(70,20);\r\n        ctx.stroke();\r\n\r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.beginPath();\r\n        ctx.arc(70, 20, 3, 0, 2*Math.PI)\r\n        ctx.fill()\r\n      }\r\n      else if(this.props.title === 'line'){\r\n        ctx.strokeStyle = this.props.uicolor;\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        ctx.moveTo(45,20);\r\n        ctx.lineTo(85,20);\r\n        ctx.stroke();\r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.beginPath();\r\n        ctx.arc(42.5, 20, 3, 0, 2*Math.PI)\r\n        ctx.arc(87.5, 20, 3, 0, 2*Math.PI)\r\n        ctx.fill()\r\n      }\r\n\r\n      else if(this.props.title === 'shadow'){\r\n        ctx.strokeStyle = this.props.uicolor;\r\n        ctx.lineWidth = 3;\r\n        ctx.beginPath();\r\n        ctx.moveTo(40,17);\r\n        ctx.lineTo(80,17);\r\n        ctx.shadowColor = this.props.uicolor;\r\n        ctx.shadowBlur = 6;\r\n        ctx.shadowOffsetX = 6;\r\n        ctx.shadowOffsetY = 6;\r\n        ctx.stroke();\r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.shadowColor = 'transparent'\r\n      }\r\n      else if(this.props.title === 'fill'){\r\n        // #path20\r\n\tctx.beginPath();\r\n\tctx.fillStyle = 'rgb(255, 255, 255)';\r\n\tctx.lineWidth = 0.224014;\r\n\tctx.moveTo(53.171595, 13.160542);\r\n\tctx.lineTo(58.256718, 18.861929);\r\n\tctx.bezierCurveTo(58.256718, 20.557044, 56.561601, 22.560180, 56.561601, 24.717437);\r\n\tctx.bezierCurveTo(56.561601, 28.261566, 61.184361, 28.261566, 61.184361, 24.563315);\r\n\tctx.bezierCurveTo(61.184361, 21.943693, 59.335123, 18.861929, 58.410615, 18.091321);\r\n\tctx.moveTo(49.473343, 11.927792);\r\n\tctx.lineTo(55.637095, 18.091544);\r\n\tctx.lineTo(43.309592, 18.091544);\r\n\tctx.moveTo(49.858647, 9.616413);\r\n\tctx.bezierCurveTo(49.473343, 9.231109, 49.473343, 9.231109, 49.088263, 9.616413);\r\n\tctx.lineTo(39.072139, 20.017842);\r\n\tctx.bezierCurveTo(38.686834, 20.403146, 38.686834, 20.403146, 39.072139, 20.788227);\r\n\tctx.lineTo(47.547269, 29.263359);\r\n\tctx.bezierCurveTo(47.932573, 29.648662, 47.932573, 29.648662, 48.317654, 29.263359);\r\n\tctx.lineTo(58.333778, 18.861929);\r\n\tctx.lineTo(58.333778, 18.091544);\r\n\tctx.fill();\r\n      }\r\n      else{\r\n        ctx.lineWidth = 1;\r\n        //title\r\n        ctx.font = \"15px Tahoma\"\r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.fillText(this.props.title, 40, 27)\r\n    }\r\n    \r\n      ctx.setLineDash([]);\r\n      //box\r\n      ctx.beginPath();\r\n      ctx.strokeStyle = this.props.uicolor\r\n      ctx.lineWidth = 3;\r\n      ctx.moveTo(110,10);\r\n      ctx.lineTo(130,10);\r\n      ctx.lineTo(130,30);\r\n      ctx.lineTo(110,30);\r\n      ctx.lineTo(110,10)\r\n      ctx.stroke();\r\n\r\n      if(this.props.penstate[this.props.title]){\r\n        ctx.beginPath();\r\n        ctx.lineWidth = 2;\r\n        ctx.moveTo(110,10);\r\n        ctx.lineTo(130,30);\r\n        ctx.moveTo(130,10);\r\n        ctx.lineTo(110,30);\r\n        ctx.stroke();\r\n      }\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <canvas id={this.props.title} ref={this.canvRef} height={this.props.height} width={this.props.width}/>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        penstate: state.penstate\r\n    }\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps)(Checkbox)","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\n\r\n// const fontSpecs = {\r\n//     fontFamily: undefined,\r\n//     color: 'white',\r\n//     fontSize: 15,\r\n//   }\r\n\r\nclass Colorpicker extends Component{\r\n    \r\n\r\n  \r\n    constructor(props){\r\n        super(props);\r\n        this.canvRef = React.createRef();\r\n    }\r\n\r\n    componentDidMount(){\r\n        const ctx = this.canvRef.current.parentElement.parentElement.firstChild.getContext('2d');\r\n        ctx.lineWidth = 1;\r\n        //title\r\n        ctx.font = \"15px Tahoma\";\r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.fillText(this.props.title, 0, 15);\r\n        console.log(ctx)\r\n        this.renderCanvas();\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        this.renderCanvas();\r\n    }\r\n  \r\n    renderCanvas(){\r\n      const ctx = this.canvRef.current.getContext('2d');\r\n      ctx.clearRect(0, 0, this.props.width, this.props.height);\r\n      var imgData = ctx.createImageData(this.props.width, this.props.height);\r\n      var s = this.props.penstate.saturation;\r\n      for (var i = 0; i < this.props.width; i += 1) {\r\n        for (var j = 0; j < this.props.height; j += 1) {\r\n            var pos = j * this.props.width * 4 + i * 4;\r\n    \r\n            var h = i / this.props.width;\r\n            var l = j / this.props.height;\r\n\r\n    \r\n            var rgb = this.hslToRgb(h, s, l);\r\n\r\n    \r\n            imgData.data[pos + 0] = rgb[0];\r\n            imgData.data[pos + 1] = rgb[1];\r\n            imgData.data[pos + 2] = rgb[2];\r\n            imgData.data[pos + 3] = 255;\r\n        }\r\n      }\r\n    \r\n        ctx.putImageData(imgData, 0, 0);\r\n    }\r\n\r\n    hslToRgb(h, s, l) {\r\n        var r, g, b;\r\n    \r\n        if (s === 0) {\r\n            r = g = b = l; // achromatic\r\n        } else {\r\n            var hue2rgb = function hue2rgb(p, q, t) {\r\n                if (t < 0) t += 1;\r\n                if (t > 1) t -= 1;\r\n                if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n                if (t < 1 / 2) return q;\r\n                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n                return p;\r\n            }\r\n    \r\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n            var p = 2 * l - q;\r\n            r = hue2rgb(p, q, h + 1 / 3);\r\n            g = hue2rgb(p, q, h);\r\n            b = hue2rgb(p, q, h - 1 / 3);\r\n        }\r\n    \r\n        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\r\n    }\r\n\r\n    render(){\r\n\r\n        return(\r\n            <div id=\"colorpickerwithtitle\">\r\n                <canvas id=\"colorpickertitle\" height=\"25px\" width=\"300px\" />\r\n                <div id={this.props.title}>\r\n                    <canvas id={this.props.title + \"el\"} ref={this.canvRef} height={this.props.height} width={this.props.width}/>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n        penstate: state.penstate\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n      setColor: (color) => { dispatch({type: \"SET_COLOR\"}) },\r\n    }\r\n  }\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Colorpicker)","import React, { Component } from 'react';\r\nimport InteractionLayer from './InteractionLayer';\r\nimport Penslider from './Penslider';\r\nimport Saturationslider from './Saturationslider';\r\nimport Checkbox from './Checkbox';\r\nimport Colorpicker from './Colorpicker';\r\nimport { connect } from 'react-redux';\r\n\r\nclass UserInterface extends Component {\r\n\r\n    state = {\r\n        height: 0,\r\n        width: 0,\r\n        colorpos: {x:0,y:0},\r\n      }\r\n\r\n    constructor(props){\r\n      super(props);\r\n      this.divRef = React.createRef();\r\n    }\r\n\r\n    componentDidMount(){\r\n        var height = document.getElementById('ui-container').clientHeight;\r\n        var width = document.getElementById('ui-container').clientWidth;\r\n        this.setState({\r\n          height,\r\n          width,\r\n        })\r\n\r\n        //setTitleCanvas\r\n        const ctx = this.divRef.current.firstChild.nextSibling.getContext('2d');\r\n\r\n        const delx = -20;\r\n        const dely = 0;\r\n        ctx.fillStyle = \"#1C1C1C\"\r\n        ctx.fillRect(delx + 40, dely + 10,40,40)\r\n        ctx.lineJoin = \"round\"\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = this.props.uicolor\r\n        ctx.rect(delx + 40, dely + 10, 40, 40);\r\n        ctx.stroke();\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(delx + 45, dely + 35);\r\n        ctx.lineTo(delx + 45, dely + 45);\r\n        ctx.lineTo(delx + 55, dely + 45);\r\n        ctx.lineTo(delx + 75, dely + 25);\r\n        ctx.lineTo(delx + 65, dely + 15);\r\n        ctx.lineTo(delx + 45, dely + 35);\r\n        ctx.moveTo(delx + 60, dely + 20);\r\n        ctx.lineTo(delx + 70, dely + 30)\r\n        ctx.stroke();\r\n\r\n        ctx.font = \"20px Tahoma\";\r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.fillText(\"Settings Penstroke\", delx + 90, dely + 38);\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        \r\n    }\r\n    \r\n    getSize(){\r\n      return {x: this.state.width, y: this.state.height}\r\n    }\r\n\r\n    interpretTraceEl(traceels){\r\n      var i, p1, p2;\r\n\r\n      if(traceels.length <2){\r\n        const checkboxes = this.divRef.current.querySelector(\"#checkboxdiv\").childNodes\r\n\r\n        for(i = 0; i < checkboxes.length; i++){\r\n          var checkbox = checkboxes[i];\r\n          p1 = {x: checkbox.offsetLeft + checkbox.parentElement.offsetLeft + 110, y: checkbox.offsetTop + checkbox.parentElement.offsetTop + 10};\r\n          p2 = {x: checkbox.offsetLeft + checkbox.parentElement.offsetLeft + 130, y: checkbox.offsetTop + checkbox.parentElement.offsetTop + 30};\r\n  \r\n          if(this.inBox(traceels[0], p1, p2)){\r\n            this.props.setCheckbox(checkbox.id)\r\n            var val = !this.props.penstate[checkbox.id];\r\n            var id = checkbox.id;\r\n            var record = {\r\n              [id]: val\r\n            };\r\n            return record;\r\n          }\r\n        }\r\n\r\n        return null\r\n      }\r\n\r\n      const sliders = this.divRef.current.querySelector(\"#sliderdiv\").childNodes\r\n\r\n      for(var i = 0; i<sliders.length; i++){\r\n        var slider = sliders[i]\r\n        p1 = {x: 50 + slider.offsetLeft, y: slider.offsetTop + slider.parentElement.offsetTop + 25};\r\n        p2 = {x: slider.offsetLeft + slider.width, y: slider.offsetTop + slider.parentElement.offsetTop + 25};\r\n\r\n\r\n        if(this.intersects(traceels[0], traceels[1], p1, p2) || (traceels[1].y == p1.y && traceels[1].y > p1.x && traceels[1].x < p2.y)){\r\n          var val = ((traceels[0].x + traceels[1].x) / 2 - 50 - slider.offsetLeft) / (slider.width - 50);\r\n          var id = slider.id;\r\n          var record = {}\r\n          if(sliders[i].id === 'saturation'){\r\n            var hsl = this.hexToHSL(this.props.penstate.color);\r\n            var hex = this.HSLToHex(hsl.h, 100*val, hsl.l);\r\n            record['color'] = hex;\r\n            record[id] = val;\r\n            this.props.setPenstate(record);\r\n            return record;\r\n          }\r\n          else{\r\n            record[id] = val;\r\n            this.props.setPenstate(record);\r\n            return record;\r\n          }\r\n        }\r\n      }\r\n\r\n      const checkboxes = this.divRef.current.querySelector(\"#checkboxdiv\").childNodes\r\n\r\n      for(i = 0; i < checkboxes.length; i++){\r\n        var checkbox = checkboxes[i];\r\n        p1 = {x: checkbox.offsetLeft + checkbox.parentElement.offsetLeft + 110, y: checkbox.offsetTop + checkbox.parentElement.offsetTop + 10};\r\n        p2 = {x: checkbox.offsetLeft + checkbox.parentElement.offsetLeft + 130, y: checkbox.offsetTop + checkbox.parentElement.offsetTop + 30};\r\n\r\n        if(!this.inBox(traceels[0], p1, p2) && this.inBox(traceels[1], p1, p2)){\r\n          this.props.setCheckbox(checkbox.id)\r\n          var val = !this.props.penstate[checkbox.id];\r\n          var id = checkbox.id;\r\n          var record = {\r\n            [id]: val\r\n          };\r\n          return record;\r\n        }\r\n\r\n        const colorpicker = this.divRef.current.querySelector(\"#colorpickerel\")\r\n        p1 = {x: colorpicker.offsetLeft, y: colorpicker.offsetTop};\r\n        p2 = {x: colorpicker.offsetLeft + colorpicker.width, y: colorpicker.offsetTop + colorpicker.height};\r\n\r\n        if(this.inBox(traceels[1],p1,p2)){\r\n          const ctx = colorpicker.getContext('2d');\r\n          var colorpos = {x:traceels[1].x - colorpicker.offsetLeft, y: traceels[1].y - colorpicker.offsetTop};\r\n          var color = ctx.getImageData(colorpos.x, colorpos.y, 1, 1).data; \r\n          var val = \"#\" + (\"000000\" +this.rgbToHex(color[0], color[1], color[2])).slice(-6);\r\n          this.props.setPenstate({color: val})\r\n          return {color: val}\r\n        }\r\n\r\n\r\n        //\r\n        //this.props.setColor()\r\n\r\n\r\n      }\r\n\r\n      return null;\r\n\r\n    }\r\n\r\n    inBox(val, p1, p2){\r\n      return val.x > p1.x && val.y > p1.y && val.x < p2.x && val.y < p2.y;\r\n    }\r\n\r\n    rgbToHex(r, g, b) {\r\n      if (r > 255 || g > 255 || b > 255)\r\n          throw \"Invalid color component\";\r\n      return ((r << 16) | (g << 8) | b).toString(16);\r\n    }\r\n\r\n    hexToHSL(H) {\r\n      // Convert hex to RGB first\r\n      let r = 0, g = 0, b = 0;\r\n      if (H.length === 4) {\r\n        r = \"0x\" + H[1] + H[1];\r\n        g = \"0x\" + H[2] + H[2];\r\n        b = \"0x\" + H[3] + H[3];\r\n      } else if (H.length === 7) {\r\n        r = \"0x\" + H[1] + H[2];\r\n        g = \"0x\" + H[3] + H[4];\r\n        b = \"0x\" + H[5] + H[6];\r\n      }\r\n      // Then to HSL\r\n      r /= 255;\r\n      g /= 255;\r\n      b /= 255;\r\n      let cmin = Math.min(r,g,b),\r\n          cmax = Math.max(r,g,b),\r\n          delta = cmax - cmin,\r\n          h = 0,\r\n          s = 0,\r\n          l = 0;\r\n    \r\n      if (delta === 0)\r\n        h = 0;\r\n      else if (cmax === r)\r\n        h = ((g - b) / delta) % 6;\r\n      else if (cmax === g)\r\n        h = (b - r) / delta + 2;\r\n      else\r\n        h = (r - g) / delta + 4;\r\n    \r\n      h = Math.round(h * 60);\r\n    \r\n      if (h < 0)\r\n        h += 360;\r\n    \r\n      l = (cmax + cmin) / 2;\r\n      s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));\r\n      s = +(s * 100).toFixed(1);\r\n      l = +(l * 100).toFixed(1);\r\n    \r\n      return {h,s,l};\r\n    }\r\n\r\n    HSLToHex(h,s,l) {\r\n      s /= 100;\r\n      l /= 100;\r\n    \r\n      let c = (1 - Math.abs(2 * l - 1)) * s,\r\n          x = c * (1 - Math.abs((h / 60) % 2 - 1)),\r\n          m = l - c/2,\r\n          r = 0,\r\n          g = 0,\r\n          b = 0;\r\n    \r\n      if (0 <= h && h < 60) {\r\n        r = c; g = x; b = 0;\r\n      } else if (60 <= h && h < 120) {\r\n        r = x; g = c; b = 0;\r\n      } else if (120 <= h && h < 180) {\r\n        r = 0; g = c; b = x;\r\n      } else if (180 <= h && h < 240) {\r\n        r = 0; g = x; b = c;\r\n      } else if (240 <= h && h < 300) {\r\n        r = x; g = 0; b = c;\r\n      } else if (300 <= h && h < 360) {\r\n        r = c; g = 0; b = x;\r\n      }\r\n      // Having obtained RGB, convert channels to hex\r\n      r = Math.round((r + m) * 255).toString(16);\r\n      g = Math.round((g + m) * 255).toString(16);\r\n      b = Math.round((b + m) * 255).toString(16);\r\n    \r\n      // Prepend 0s, if necessary\r\n      if (r.length === 1)\r\n        r = \"0\" + r;\r\n      if (g.length === 1)\r\n        g = \"0\" + g;\r\n      if (b.length === 1)\r\n        b = \"0\" + b;\r\n    \r\n      return \"#\" + r + g + b;\r\n    }\r\n\r\n\r\n    intersects(p1, p2, p3, p4) {\r\n      var a = p1.x;\r\n      var b = p1.y;\r\n      var c = p2.x;\r\n      var d = p2.y;\r\n      var p = p3.x;\r\n      var q = p3.y;\r\n      var r = p4.x;\r\n      var s = p4.y;\r\n  \r\n      var det, gamma, lambda;\r\n      det = (c - a) * (s - q) - (r - p) * (d - b);\r\n      if (det === 0) {\r\n        return false;\r\n      } else {\r\n        lambda = ((s - q) * (r - a) + (p - r) * (s - b)) / det;\r\n        gamma = ((b - d) * (r - a) + (c - a) * (s - b)) / det;\r\n        return (0 < lambda && lambda < 1) && (0 < gamma && gamma < 1);\r\n      }\r\n    };\r\n\r\n    render(){\r\n        return(\r\n            <div id=\"ui-container\" ref={this.divRef}>\r\n              <InteractionLayer getSize={this.getSize.bind(this)} interpretTraceEl={this.interpretTraceEl.bind(this)} uicolor={this.props.uicolor} />\r\n\r\n              <canvas id=\"uititle\" height=\"60px\" width=\"400px\"></canvas>\r\n\r\n              <svg height=\"3\" width=\"400\" className=\"uiline\">\r\n                <line x1=\"0\" y1=\"2\" x2=\"400\" y2=\"2\" stroke=\"black\" />\r\n              </svg> \r\n              \r\n              <div id=\"checkboxdiv\">\r\n                <Checkbox title={\"linedash\"} className=\"pencheckbox\" width={this.state.width*.5} height={40} uicolor={this.props.uicolor}/>\r\n                <Checkbox title={\"fill\"} className=\"pencheckbox\" width={this.state.width*.5} height={40} uicolor={this.props.uicolor}/>\r\n                <Checkbox title={\"end\"} className=\"pencheckbox\" width={this.state.width*.5} height={40} uicolor={this.props.uicolor}/>\r\n                <Checkbox title={\"shadow\"} className=\"pencheckbox\" width={this.state.width*.5} height={40} uicolor={this.props.uicolor}/>\r\n                <Checkbox title={\"line\"} className=\"pencheckbox\" width={this.state.width*.5} height={40} uicolor={this.props.uicolor}/>\r\n              </div>\r\n\r\n              <svg height=\"3\" width=\"400\" className=\"uiline\">\r\n                <line x1=\"0\" y1=\"2\" x2=\"400\" y2=\"2\" stroke=\"black\" />\r\n              </svg> \r\n\r\n              <div id=\"sliderdiv\">\r\n                <Penslider title={\"alpha\"} className=\"penslider\" width={this.state.width} height={50} uicolor={this.props.uicolor}/>\r\n                <Penslider title={\"point\"} className=\"penslider\" width={this.state.width} height={50} uicolor={this.props.uicolor}/>\r\n                <Saturationslider title={\"saturation\"} className=\"penslider\" width={this.state.width} height={50} uicolor={this.props.uicolor}/>\r\n              </div>\r\n\r\n              <svg height=\"3\" width=\"400\" className=\"uiline\">\r\n                <line x1=\"0\" y1=\"2\" x2=\"400\" y2=\"2\" stroke=\"black\" />\r\n              </svg> \r\n\r\n              <Colorpicker title={\"colorpicker\"} colorpos={this.state.colorpos} width={320} height={200} uicolor={this.props.uicolor}/>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n    penstate: state.penstate,\r\n    uicolor: state.uicolor\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    setCheckbox: (type) => { dispatch({type: \"CHECK\", id: type}) },\r\n    setPenstate: (val) => { dispatch({type: 'SET_PENSTATE', update:val}) },\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserInterface);","import React, { Component } from 'react';\r\n\r\nclass Topruler extends Component {\r\n    state = {\r\n        width: 0\r\n    }\r\n\r\n    constructor(props){\r\n        super(props)\r\n        this.barRef = React.createRef();\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        const svgel = this.barRef.current\r\n        if(svgel.width.animVal.value - this.state.width > 1){\r\n            this.setState({\r\n                width: svgel.width.animVal.value,\r\n            })\r\n            this.drawRuler()\r\n        }\r\n    }\r\n\r\n    drawRuler(){\r\n\r\n        const svgel = this.barRef.current\r\n        const width = svgel.width.animVal.value;\r\n        const height = svgel.height.animVal.value;\r\n        const canvwidth = document.getElementById('drawing-canvas').width;\r\n\r\n        const elstart = (width - canvwidth + height)/2;\r\n\r\n\r\n        while(svgel.firstChild){\r\n            svgel.removeChild(svgel.firstChild);\r\n        }\r\n\r\n        for(var i = -Math.floor(elstart/5)*5 + 25; i < canvwidth + elstart; i= i + 5){\r\n            var newElement, p1,p2\r\n            if(Math.abs(i) % 100 < 1){\r\n                newElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path'); //Create a path in SVG's namespace\r\n                p1 = \"M \" + (i + Math.floor(elstart)) + \" \" + 12\r\n                p2 = \"L \" + (i + Math.floor(elstart)) + \" \" + 20\r\n                newElement.setAttribute(\"d\", p1 + \" \" + p2); //Set path's data\r\n                newElement.style.stroke = \"#C6C6C6\"; //Set stroke colour\r\n                newElement.style.strokeWidth = \"1px\"; //Set stroke width\r\n                svgel.appendChild(newElement);\r\n\r\n                var newText = document.createElementNS(\"http://www.w3.org/2000/svg\", 'text');\r\n                newText.setAttributeNS(null,\"x\",i + Math.floor(elstart));     \r\n                newText.setAttributeNS(null,\"y\",10); \r\n                newText.setAttributeNS(null,\"text-anchor\", \"middle\"); \r\n                newText.setAttributeNS(null,\"font-size\",\"9\");\r\n                newText.style.stroke = \"#C6C6C6\";\r\n                newText.innerHTML = i\r\n                svgel.appendChild(newText);\r\n\r\n\r\n\r\n            } \r\n            else if(Math.abs(i) % 20 < 1){\r\n                newElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path'); //Create a path in SVG's namespace\r\n                p1 = \"M \" + (i + Math.floor(elstart)) + \" \" + 16\r\n                p2 = \"L \" + (i + Math.floor(elstart)) + \" \" + 20\r\n                newElement.setAttribute(\"d\", p1 + \" \" + p2); //Set path's data\r\n                newElement.style.stroke = \"#C6C6C6\"; //Set stroke colour\r\n                newElement.style.strokeWidth = \"1px\"; //Set stroke width\r\n                svgel.appendChild(newElement);\r\n            }\r\n            else{\r\n                newElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path'); //Create a path in SVG's namespace\r\n                p1 = \"M \" + (i + Math.floor(elstart)) + \" \" + 18\r\n                p2 = \"L \" + (i + Math.floor(elstart)) + \" \" + 20\r\n                newElement.setAttribute(\"d\", p1 + \" \" + p2); //Set path's data\r\n                newElement.style.stroke = \"#C6C6C6\"; //Set stroke colour\r\n                newElement.style.strokeWidth = \"1px\"; //Set stroke width\r\n                svgel.appendChild(newElement);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    render(){\r\n\r\n        return(\r\n          <svg ref={this.barRef} className=\"ruler\" height=\"20\" width=\"100%\"></svg>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Topruler;","import React, { Component } from 'react';\r\n\r\nclass Sideruler extends Component {\r\n    state = {\r\n        height: 0\r\n    }\r\n\r\n    constructor(props){\r\n        super(props)\r\n        this.barRef = React.createRef();\r\n    }\r\n\r\n    componentDidUpdate(){\r\n        const svgel = this.barRef.current\r\n        if(Math.abs(svgel.height.animVal.value - this.state.height) > 1){\r\n            this.setState({\r\n                height: svgel.height.animVal.value,\r\n            })\r\n            this.drawRuler()\r\n        }\r\n    }\r\n\r\n    drawRuler(){\r\n\r\n        const svgel = this.barRef.current\r\n        const width = svgel.width.animVal.value;\r\n        const height = svgel.height.animVal.value;\r\n        const canvheight = document.getElementById('drawing-canvas').height;\r\n\r\n        const elstart = (height - canvheight + width)/2;\r\n\r\n\r\n        while(svgel.firstChild){\r\n            svgel.removeChild(svgel.firstChild);\r\n        }\r\n\r\n        for(var i = -Math.floor(elstart/5)*5 + 25; i < canvheight + elstart; i= i + 5){\r\n            var newElement, p1, p2\r\n            if(Math.abs(i) % 100 < 1){\r\n                newElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path'); //Create a path in SVG's namespace\r\n                p1 = \"M \" + 12 + \" \" +(i + Math.floor(elstart));\r\n                p2 = \"L \" + 20 + \" \" + (i + Math.floor(elstart));\r\n                newElement.setAttribute(\"d\", p1 + \" \" + p2); //Set path's data\r\n                newElement.style.stroke = \"#C6C6C6\"; //Set stroke colour\r\n                newElement.style.strokeWidth = \"1px\"; //Set stroke width\r\n                svgel.appendChild(newElement);\r\n\r\n                var newText = document.createElementNS(\"http://www.w3.org/2000/svg\", 'text');\r\n                newText.setAttributeNS(null,\"y\",i + Math.floor(elstart));     \r\n                newText.setAttributeNS(null,\"x\",10); \r\n                newText.setAttributeNS(null,\"text-anchor\", \"middle\"); \r\n                newText.setAttributeNS(null,\"font-size\",\"9\");\r\n                newText.style.stroke = \"#C6C6C6\";\r\n                newText.setAttributeNS(null,\"transform\",\"rotate(270,10,\"+ (Math.floor(elstart) + i) +\")\");\r\n                newText.innerHTML = i\r\n                svgel.appendChild(newText);\r\n\r\n\r\n\r\n            } \r\n            else if(Math.abs(i) % 20 < 1){\r\n                newElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path'); //Create a path in SVG's namespace\r\n                p1 = \"M \" + 16 + \" \" +(i + Math.floor(elstart));\r\n                p2 = \"L \" + 20 + \" \" + (i + Math.floor(elstart));\r\n                newElement.setAttribute(\"d\", p1 + \" \" + p2); //Set path's data\r\n                newElement.style.stroke = \"#000\"; //Set stroke colour\r\n                newElement.style.strokeWidth = \"1px\"; //Set stroke width\r\n                newElement.style.stroke = \"#C6C6C6\";\r\n                svgel.appendChild(newElement);\r\n            }\r\n            else{\r\n                newElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path'); //Create a path in SVG's namespace\r\n                p1 = \"M \" + 18 + \" \" +(i + Math.floor(elstart));\r\n                p2 = \"L \" + 20 + \" \" + (i + Math.floor(elstart));\r\n                newElement.setAttribute(\"d\", p1 + \" \" + p2); //Set path's data\r\n                newElement.style.stroke = \"#000\"; //Set stroke colour\r\n                newElement.style.strokeWidth = \"1px\"; //Set stroke width\r\n                newElement.style.stroke = \"#C6C6C6\";\r\n                svgel.appendChild(newElement);\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    render(){\r\n\r\n        return(\r\n          <svg ref={this.barRef} className=\"ruler\" height=\"100%\" width=\"20px\"></svg>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Sideruler;","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\n\r\nclass Drawingsample extends Component {\r\n\r\n    state = {}\r\n  \r\n    constructor(props){\r\n        super(props);\r\n        this.canvRef = React.createRef()\r\n    }\r\n\r\n    getSize(){\r\n      return {x: this.state.width, y: this.state.height}\r\n    }\r\n  \r\n    componentDidMount(){\r\n      var height = document.getElementById('drawingsample-canvas').clientHeight;\r\n      var width = document.getElementById('drawingsample-canvas').clientWidth;\r\n      console.log(height,width)\r\n      this.setState({\r\n        height: height,\r\n        width: width,\r\n      })\r\n    }    \r\n  \r\n    componentDidUpdate(){\r\n      var penstate = this.props.penstate;\r\n      const ctx = this.canvRef.current.getContext('2d');\r\n      ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n\r\n      ctx.strokeStyle = this.getColor(penstate);\r\n      ctx.lineWidth = this.getPoint(penstate);\r\n      if(penstate.linedash){\r\n        ctx.setLineDash([ctx.lineWidth,ctx.lineWidth])\r\n      }\r\n      else{\r\n        ctx.setLineDash([])\r\n      }\r\n      var trace = this.sampleTrace();\r\n\r\n      if(penstate.end){\r\n        ctx.lineCap = \"round\"\r\n      }\r\n      else {\r\n        ctx.lineCap = \"butt\"\r\n      }\r\n\r\n      if(penstate.shadow){\r\n        ctx.shadowColor = this.getColor(penstate);\r\n        ctx.shadowOffsetX = 20;\r\n        ctx.shadowOffsetY = 20;\r\n        ctx.shadowBlur = 10;\r\n      }\r\n      else{\r\n        ctx.shadowColor = \"transparent\"\r\n      }\r\n\r\n      ctx.beginPath();\r\n      ctx.moveTo((trace[0].x-460), (trace[0].y-390));\r\n\r\n      if(penstate.line){\r\n        ctx.lineTo((trace[trace.length-1].x-460), (trace[trace.length-1].y-390));\r\n      }\r\n      else{\r\n        for (var j = 1; j < trace.length; j++){\r\n            ctx.lineTo((trace[j].x-460), (trace[j].y-390));\r\n        }\r\n      }\r\n\r\n      if(penstate.fill){\r\n        ctx.fillStyle = ctx.strokeStyle;\r\n        ctx.fill()\r\n      }\r\n      else{\r\n        ctx.stroke()\r\n      }\r\n            \r\n    }\r\n\r\n    getColor(penstate){\r\n        var newcolor = penstate.color.slice(0,7)\r\n        if(penstate.alpha * 255 < 17){\r\n            newcolor = newcolor + \"0\" + Math.floor(penstate.alpha*255).toString(16);\r\n        }\r\n        else {\r\n            newcolor = newcolor + Math.floor(penstate.alpha*255).toString(16);\r\n        }\r\n        return newcolor;\r\n    }\r\n\r\n    getPoint(penstate){\r\n        return penstate.point * 50;\r\n    }\r\n\r\n    sampleTrace() {\r\n        return [\r\n          {x: 568, y: 412.66668701171875}\r\n        , {x: 567.3333740234375, y: 412.66668701171875}\r\n        , {x: 566.6666870117188, y: 412.66668701171875}\r\n        , {x: 565.3333740234375, y: 412.66668701171875}\r\n        , {x: 564.6666870117188, y: 412.66668701171875}\r\n        , {x: 563.3333740234375, y: 412.66668701171875}\r\n        , {x: 560.6666870117188, y: 412.66668701171875}\r\n        , {x: 557.3333740234375, y: 413.3333740234375}\r\n        , {x: 553.3333740234375, y: 413.3333740234375}\r\n        , {x: 548, y: 414}\r\n        , {x: 542, y: 414.66668701171875}\r\n        , {x: 535.3333740234375, y: 416}\r\n        , {x: 528, y: 418}\r\n        , {x: 520.6666870117188, y: 419.3333740234375}\r\n        , {x: 514.6666870117188, y: 422}\r\n        , {x: 508, y: 424}\r\n        , {x: 502.66668701171875, y: 426.66668701171875}\r\n        , {x: 498, y: 429.3333740234375}\r\n        , {x: 494, y: 432}\r\n        , {x: 491.3333740234375, y: 434}\r\n        , {x: 489.3333740234375, y: 436.66668701171875}\r\n        , {x: 488, y: 439.3333740234375}\r\n        , {x: 488, y: 441.3333740234375}\r\n        , {x: 488.66668701171875, y: 444}\r\n        , {x: 490, y: 446}\r\n        , {x: 492.66668701171875, y: 448}\r\n        , {x: 496.66668701171875, y: 449.3333740234375}\r\n        , {x: 501.3333740234375, y: 451.3333740234375}\r\n        , {x: 506, y: 453.3333740234375}\r\n        , {x: 511.3333740234375, y: 454.66668701171875}\r\n        , {x: 516.6666870117188, y: 457.3333740234375}\r\n        , {x: 521.3333740234375, y: 459.3333740234375}\r\n        , {x: 525.3333740234375, y: 461.3333740234375}\r\n        , {x: 528, y: 463.3333740234375}\r\n        , {x: 530.6666870117188, y: 465.3333740234375}\r\n        , {x: 532.6666870117188, y: 468}\r\n        , {x: 533.3333740234375, y: 470}\r\n        , {x: 533.3333740234375, y: 472.66668701171875}\r\n        , {x: 532.6666870117188, y: 474}\r\n        , {x: 531.3333740234375, y: 476}\r\n        , {x: 530, y: 477.3333740234375}\r\n        , {x: 528, y: 479.3333740234375}\r\n        , {x: 525.3333740234375, y: 480.66668701171875}\r\n        , {x: 522.6666870117188, y: 482}\r\n        , {x: 520.6666870117188, y: 484}\r\n        , {x: 518, y: 486}\r\n        , {x: 516, y: 488}\r\n        , {x: 514, y: 490.66668701171875}\r\n        , {x: 512, y: 492.66668701171875}\r\n        , {x: 511.3333740234375, y: 495.3333740234375}\r\n        , {x: 510.66668701171875, y: 498.66668701171875}\r\n        , {x: 510.66668701171875, y: 502}\r\n        , {x: 511.3333740234375, y: 506}\r\n        , {x: 512.6666870117188, y: 510}\r\n        , {x: 514, y: 514}\r\n        , {x: 516, y: 517.3333740234375}\r\n        , {x: 518, y: 522}\r\n        , {x: 519.3333740234375, y: 525.3333740234375}\r\n        , {x: 520.6666870117188, y: 529.3333740234375}\r\n        , {x: 520.6666870117188, y: 532.6666870117188}\r\n        , {x: 521.3333740234375, y: 536}\r\n        , {x: 520.6666870117188, y: 539.3333740234375}\r\n        , {x: 519.3333740234375, y: 542}\r\n        , {x: 518, y: 545.3333740234375}\r\n        , {x: 515.3333740234375, y: 548.6666870117188}\r\n        , {x: 513.3333740234375, y: 552}\r\n        , {x: 511.3333740234375, y: 556}\r\n        , {x: 510, y: 560.6666870117188}\r\n        , {x: 509.3333740234375, y: 565.3333740234375}\r\n        , {x: 509.3333740234375, y: 570}\r\n        , {x: 510, y: 575.3333740234375}]\r\n    }\r\n\r\n  \r\n    render() {\r\n      return (\r\n        <canvas id=\"drawingsample-canvas\" \r\n        ref={this.canvRef} \r\n        height={this.getSize().y} \r\n        width={this.getSize().x}\r\n        ></canvas>\r\n      );\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n    penstate: state.penstate\r\n  }\r\n}\r\n  \r\n\r\nexport default connect(mapStateToProps)(Drawingsample)","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport Topruler from './Topruler';\r\nimport Sideruler from './Sideruler';\r\nimport Drawingsample from './Drawingsample';\r\n\r\n\r\nclass Canvas extends Component {\r\n\r\n    state = {\r\n        pointertrace: [],\r\n        pendown: false,\r\n\r\n        //for image placement\r\n        transform: {type: 'mid', x:0, y:0},\r\n        moveref: null\r\n      }\r\n\r\n    constructor(props){\r\n      super(props)\r\n      this.canvRef = React.createRef();\r\n    }\r\n\r\n    componentDidMount(){\r\n        var height = document.getElementById('drawing-canvas').clientHeight;\r\n        var width = document.getElementById('drawing-canvas').clientWidth;\r\n        var containerheight = document.getElementById('drawing-canvas-container').clientHeight;\r\n        var containerwidth = document.getElementById('drawing-canvas-container').clientWidth;\r\n        this.setState({\r\n          height,\r\n          width,\r\n          containerheight,\r\n          containerwidth,\r\n        })\r\n\r\n        //draw imageupload container\r\n        const ctx = this.canvRef.current.lastChild.firstChild.getContext('2d');\r\n        ctx.fillStyle = \"#333333\"\r\n        ctx.fillRect(0, 0, 100, 100);\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = this.props.uicolor;\r\n        ctx.setLineDash([6]);\r\n        ctx.strokeRect(0, 0, 100, 100);\r\n        ctx.textAlign = \"center\"; \r\n        ctx.textBaseline = \"middle\"; \r\n        ctx.fillStyle = this.props.uicolor;\r\n        ctx.font = \"15px Tahoma\";\r\n        const fillText = \"upload image\"\r\n        ctx.fillText(fillText, 50, 45); \r\n        ctx.font = \"7px Tahoma\";\r\n        const fillText2 = \"click or drag your image here\"\r\n        ctx.fillText(fillText2, 50, 60); \r\n    \r\n    }\r\n    componentDidUpdate(){\r\n\r\n      const ctx = this.canvRef.current.firstChild.firstChild.getContext('2d');\r\n      var t = this.props.t + this.props.deltaT;\r\n\r\n\r\n\r\n      //check if imageplacement\r\n      var imageplacement = false;\r\n\r\n      var indexT\r\n      for(indexT = this.props.traces.length - 1; indexT > 0; --indexT){\r\n        if(this.props.traces[indexT].t > t){\r\n        }\r\n        else{\r\n          break;\r\n        }\r\n      }\r\n      var indexImg;\r\n      for(indexImg = indexT; indexImg > 0; indexImg--){\r\n        if(this.props.traces[indexImg].type === 'image'){\r\n          imageplacement = true;\r\n          break;\r\n        }\r\n        else if (this.props.traces[indexImg].type === 'draw'){\r\n          break;\r\n        }\r\n        else if (this.props.traces[indexImg].transform && this.props.traces[indexImg].transform.type === 'place'){\r\n          break;\r\n        }\r\n      }\r\n\r\n      var img\r\n      if(imageplacement){\r\n        img = this.props.traces[indexImg].imgData\r\n      }\r\n\r\n      //checkspiral\r\n      if(!this.state.spiralMode && this.props.history === '3' && this.state.pointertrace.length > 0){\r\n        const spiralRef = this.state.pointertrace[0]\r\n        var spiralCounter = 0;\r\n        for(var i = 3; i < this.state.pointertrace.length - 1; i++){\r\n          if(this.dist(this.state.pointertrace[i], spiralRef) < 20){\r\n            if(this.dist(this.state.pointertrace[i-1], spiralRef) > this.dist(this.state.pointertrace[i], spiralRef) && this.dist(this.state.pointertrace[i], spiralRef) < this.dist(this.state.pointertrace[i+1], spiralRef)){\r\n              spiralCounter++\r\n            }\r\n          }\r\n        }\r\n        if (spiralCounter > 2){\r\n          this.setState({\r\n            pointertrace: [],\r\n            spiralMode: true,\r\n            deltaT: this.props.deltaT\r\n          })\r\n        }\r\n      }\r\n\r\n      ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n      var penstate = this.props.penstate;\r\n\r\n      ctx.strokeStyle = this.getColor(penstate);\r\n      ctx.lineWidth = this.getPoint(penstate);\r\n\r\n      if(this.state.spiralMode){\r\n        penstate = {\r\n          color: '#000000',\r\n          alpha: 1,\r\n          point: .05,\r\n          linedash: false,\r\n        }\r\n      }\r\n      \r\n      //TODO try move to pendown\r\n      if(imageplacement){\r\n        penstate = {\r\n            color: '#000000',\r\n            alpha: 1,\r\n            point: .05,\r\n            linedash: false,\r\n        }\r\n\r\n        //possible image transformation\r\n          var refX = 0;\r\n          var refY = 0;\r\n          var refWidth = this.state.imgwidth;\r\n          var refHeight = this.state.imgheight;\r\n\r\n          //var temptransform = \"\";\r\n          var i = indexImg;\r\n\r\n          var shadowpenstate = this.props.initpenstate;\r\n\r\n          for(var ind; ind <= i; ind++){\r\n            if(this.props.traces[ind].changes){\r\n              shadowpenstate = [...shadowpenstate, this.props.traces[ind].changes]\r\n            }\r\n          }\r\n\r\n          var color = shadowpenstate.color;\r\n          var shadow = shadowpenstate.shadow;\r\n\r\n\r\n          if(this.props.penstate.shadow){\r\n            ctx.shadowColor = this.getColor(this.props.penstate)\r\n            ctx.shadowOffsetX = 20;\r\n            ctx.shadowOffsetY = 20;\r\n            ctx.shadowBlur = 10;\r\n          }\r\n          else if(this.props.penstate.shadow === false){\r\n            ctx.shadowColor = \"transparent\"\r\n          }\r\n          // if(this.props.traces[i].changes.color){\r\n          //   color = this.props.traces[i].changes.color;\r\n          //   ctx.shadowColor = color;\r\n          // }\r\n\r\n          // for(i = this.props.traces.length - 1; i >= 0; i--){\r\n          //   if(this.props.traces[i].type === 'image'){\r\n          //     break\r\n          //   }\r\n            \r\n          //   else if (this.props.traces[i].type === 'imgtrace'){\r\n          //     if(this.props.traces[i].transform.type === 'place'){\r\n          //       i= -2;\r\n          //       break\r\n          //     }\r\n          //   }\r\n          // }\r\n          for(i++; 0 < i && i < this.props.traces.length; i++){\r\n            if(this.props.traces[i].t > t){\r\n              break;\r\n            }\r\n            if(!this.props.traces[i].transform){\r\n              //TODO add UItraces\r\n              continue\r\n            }\r\n            switch(this.props.traces[i].transform.type){\r\n              case('mid'):\r\n                //temptransform = this.getMatrixString([1,0,0,1,this.props.traces[i].transform.x, this.props.traces[i].transform.y]) + ' ' + temptransform;\r\n                refX += this.props.traces[i].transform.x;\r\n                refY += this.props.traces[i].transform.y;\r\n                break;\r\n              case('tl'):\r\n                //temptransform = this.getMatrixString([this.props.traces[i].transform.f1, 0,0, this.props.traces[i].transform.f2, (1-this.props.traces[i].transform.f1) * (refWidth + refX), (1-this.props.traces[i].transform.f2) * (refHeight + refY)]) + ' ' + temptransform;\r\n                refX += (1-this.props.traces[i].transform.f1) * (refWidth)\r\n                refY += (1-this.props.traces[i].transform.f2) * (refHeight)\r\n                refWidth *= this.props.traces[i].transform.f1;\r\n                refHeight *= this.props.traces[i].transform.f2;\r\n                break;\r\n              case('tr'):\r\n                //temptransform = this.getMatrixString([this.props.traces[i].transform.f1, 0,0, this.props.traces[i].transform.f2, (1-this.props.traces[i].transform.f1) * (refX), (1-this.props.traces[i].transform.f2) * (refHeight + refY)]) + ' ' + temptransform;\r\n                refY += (1-this.props.traces[i].transform.f2) * (refHeight);\r\n                refWidth *= this.props.traces[i].transform.f1;\r\n                refHeight *= this.props.traces[i].transform.f2;\r\n                break;\r\n              case('bl'):\r\n                //temptransform = this.getMatrixString([this.props.traces[i].transform.f1, 0,0, this.props.traces[i].transform.f2, (1-this.props.traces[i].transform.f1) * (refWidth + refX), (1-this.props.traces[i].transform.f2) * (refY)]) + ' ' + temptransform;\r\n                refX += (1-this.props.traces[i].transform.f1) * (refWidth)\r\n                refWidth *= this.props.traces[i].transform.f1;\r\n                refHeight *= this.props.traces[i].transform.f2;\r\n                break;\r\n              case('br'):\r\n                //temptransform = this.getMatrixString([this.props.traces[i].transform.f1, 0,0, this.props.traces[i].transform.f2, (1-this.props.traces[i].transform.f1) * refX, (1-this.props.traces[i].transform.f2) * refY]) + ' ' + temptransform;\r\n                refWidth *= this.props.traces[i].transform.f1;\r\n                refHeight *= this.props.traces[i].transform.f2;\r\n                break;\r\n            }\r\n\r\n            // const ctx = this.canvRef.current.firstChild.firstChild.getContext('2d');\r\n            // ctx.beginPath()\r\n            // ctx.moveTo(refX+refWidth,refY)\r\n            // ctx.lineTo(refX,refY);\r\n            // ctx.lineTo(refX, refY + refHeight);\r\n            // ctx.stroke()\r\n          }\r\n\r\n          switch(this.state.transform.type){\r\n            case('mid'):\r\n              //temptransform = this.getMatrixString([1,0,0,1,this.state.transform.x,this.state.transform.y]) + ' ' + temptransform;\r\n              refX += this.state.transform.x;\r\n              refY += this.state.transform.y;\r\n              break;\r\n            case('tl'):\r\n              //temptransform = this.getMatrixString([this.state.transform.f1, 0,0, this.state.transform.f2, (1-this.state.transform.f1) * (refWidth + refX), (1-this.state.transform.f2) * (refHeight + refY)]) + ' ' + temptransform;\r\n              refX += (1-this.state.transform.f1) * (refWidth);\r\n              refY += (1-this.state.transform.f2) * (refHeight);\r\n              refWidth *= this.state.transform.f1;\r\n              refHeight *= this.state.transform.f2;\r\n              break\r\n            case('tr'):\r\n              //temptransform = this.getMatrixString([this.state.transform.f1, 0,0, this.state.transform.f2, (1-this.state.transform.f1) * (refX), (1-this.state.transform.f2) * (refHeight + refY)]) + ' ' + temptransform;\r\n              refY += (1-this.state.transform.f2) * (refHeight);\r\n              refWidth *= this.state.transform.f1;\r\n              refHeight *= this.state.transform.f2;\r\n              break;\r\n            case('bl'):\r\n              //temptransform = this.getMatrixString([this.state.transform.f1, 0,0, this.state.transform.f2, (1-this.state.transform.f1) * (refWidth + refX), (1-this.state.transform.f2) * (refY)]) + ' ' + temptransform;\r\n              refX += (1-this.state.transform.f1) * (refWidth)\r\n              refWidth *= this.state.transform.f1;\r\n              refHeight *= this.state.transform.f2;\r\n              break;\r\n            case('br'):\r\n              //temptransform = this.getMatrixString([this.state.transform.f1, 0,0, this.state.transform.f2, (1-this.state.transform.f1) * refX, (1-this.state.transform.f2) * refY]) + ' ' + temptransform;\r\n              refWidth *= this.state.transform.f1;\r\n              refHeight *= this.state.transform.f2;\r\n              break;\r\n          }\r\n          //from old version of imageplacement\r\n          // if(this.state.imageplacement){\r\n          //   this.canvRef.current.firstChild.lastChild.style.transform = temptransform;\r\n          // }\r\n          ctx.drawImage(img, refX, refY, refWidth, refHeight);\r\n          this.displayHandlers(refX, refY, refWidth, refHeight);\r\n          console.log(refX, refY)\r\n      }else{\r\n        this.hideHandlers();\r\n      }\r\n\r\n      if(this.state.pendown){\r\n        if(this.state.spiralMode){\r\n          this.drawalltraces();\r\n        }\r\n        //draw current trace\r\n        ctx.strokeStyle = this.getColor(penstate);\r\n        ctx.lineWidth = this.getPoint(penstate);\r\n\r\n        if(penstate.linedash){\r\n          ctx.setLineDash([ctx.lineWidth, ctx.lineWidth]);\r\n        }\r\n        else{\r\n          ctx.setLineDash([])\r\n        }\r\n        \r\n        if(penstate.end){\r\n          ctx.lineCap = \"round\"\r\n        }\r\n        else {\r\n          ctx.lineCap = \"butt\"\r\n        }\r\n\r\n        if(penstate.shadow){\r\n          ctx.shadowColor = this.getColor(penstate);\r\n          ctx.shadowOffsetX = 20;\r\n          ctx.shadowOffsetY = 20;\r\n          ctx.shadowBlur = 10;\r\n        }\r\n        else{\r\n          ctx.shadowColor = \"transparent\"\r\n        }\r\n        \r\n        if (this.state.pointertrace.length > 1){\r\n          ctx.beginPath();\r\n          ctx.moveTo(this.state.pointertrace[0].x, this.state.pointertrace[0].y);\r\n\r\n          if(penstate.line){\r\n            ctx.lineTo(this.state.pointertrace[this.state.pointertrace.length-1].x, this.state.pointertrace[this.state.pointertrace.length-1].y)\r\n          }\r\n          else{\r\n            for (i = 1; i < this.state.pointertrace.length; i++){\r\n                  ctx.lineTo(this.state.pointertrace[i].x, this.state.pointertrace[i].y);\r\n            }\r\n          }\r\n\r\n          if(penstate.fill){\r\n            ctx.fillStyle = ctx.strokeStyle;\r\n            ctx.fill()\r\n          }\r\n          else{\r\n            ctx.stroke()\r\n          }\r\n        }\r\n        \r\n      }\r\n      else{\r\n        this.drawalltraces()\r\n      }\r\n      this.displaytraces()\r\n\r\n\r\n      //draw current trace\r\n      \r\n    }\r\n\r\n    displayHandlers(refX, refY, refWidth, refHeight){\r\n      //topleft\r\n      var el = document.getElementById(\"resizehandleTL\");\r\n      el.style.display = \"block\";\r\n      el.style.top = refY - 25 + \"px\";\r\n      el.style.left = refX - 25 + \"px\";\r\n      //topleft\r\n      el = document.getElementById(\"resizehandleTR\");\r\n      el.style.display = \"block\";\r\n      el.style.top = refY - 25 + \"px\";\r\n      el.style.left = refWidth + refX - 25 + \"px\";\r\n      //topleft\r\n      el = document.getElementById(\"resizehandleBL\");\r\n      el.style.display = \"block\";\r\n      el.style.top = refY + refHeight - 25 + \"px\";\r\n      el.style.left = refX - 25 + \"px\";\r\n      //topleft\r\n      el = document.getElementById(\"resizehandleBR\");\r\n      el.style.display = \"block\";\r\n      el.style.top = refY + refHeight - 25 + \"px\";\r\n      el.style.left = refX + refWidth - 25 + \"px\";\r\n      //topleft\r\n      el = document.getElementById(\"resizehandleMID\");\r\n      el.style.display = \"block\";\r\n      el.style.top = refY + refHeight/2 - 25 + \"px\";\r\n      el.style.left = refX + refWidth/2 - 25 + \"px\";\r\n    }\r\n\r\n    hideHandlers(){\r\n      var el = document.getElementById(\"resizehandleTL\");\r\n      el.style.display = \"none\";\r\n      var el = document.getElementById(\"resizehandleTR\");\r\n      el.style.display = \"none\";\r\n      var el = document.getElementById(\"resizehandleBL\");\r\n      el.style.display = \"none\";\r\n      var el = document.getElementById(\"resizehandleBR\");\r\n      el.style.display = \"none\";\r\n      var el = document.getElementById(\"resizehandleMID\");\r\n      el.style.display = \"none\";\r\n    }\r\n    \r\n    getSize(){\r\n        return {x: this.state.width, y: this.state.height}\r\n      }\r\n\r\n    dist(a,b){\r\n      return Math.pow(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2), .5);\r\n    }\r\n\r\n    diff(a,b){\r\n      return {x: a.x - b.x, y: a.y - b.y};\r\n    }\r\n\r\n    angle(p1,p2,mid){\r\n      var vecA = this.diff(p1, mid);\r\n      var vecB = this.diff(p2, mid);\r\n      var valA = this.dist(p1,mid);\r\n      var valB = this.dist(p2,mid);\r\n      var sign = vecA.x * vecB.y - vecA.y * vecB.x > 0 ? -1:1;\r\n      return sign * Math.acos((vecA.x * vecB.x + vecA.y * vecB.y) / (valA * valB))\r\n    }\r\n\r\n    pointerDownHandler(e) {\r\n\r\n      const offsetTop = this.canvRef.current.firstChild.offsetTop + this.canvRef.current.parentElement.offsetTop;\r\n      const offsetLeft = this.canvRef.current.firstChild.offsetLeft + this.canvRef.current.parentElement.offsetLeft;\r\n      var p = {x: e.clientX - offsetLeft, y: e.clientY - offsetTop};\r\n\r\n      //check if imageplacement\r\n      var imageplacement = false;\r\n      var t = this.props.t + this.props.deltaT;\r\n\r\n      var indexT\r\n      for(indexT = this.props.traces.length - 1; indexT > 0; --indexT){\r\n        if(this.props.traces[indexT].t > t){\r\n        }\r\n        else{\r\n          break;\r\n        }\r\n      }\r\n      var indexImg;\r\n      for(indexImg = indexT; indexImg > 0; indexImg--){\r\n        if(this.props.traces[indexImg].type === 'image'){\r\n          imageplacement = true;\r\n          break;\r\n        }\r\n        else if (this.props.traces[indexImg].type === 'draw'){\r\n          break;\r\n        }\r\n        else if (this.props.traces[indexImg].transform && this.props.traces[indexImg].transform.type === 'place'){\r\n          break;\r\n        }\r\n      }\r\n\r\n      if(imageplacement){\r\n        const div = this.canvRef.current.firstChild.lastChild;\r\n        //const rect = this.canvRef.current.firstChild.lastChild.getBoundingClientRect();\r\n\r\n        var tl = document.getElementById(\"resizehandleTL\").getBoundingClientRect();\r\n        var tr = document.getElementById(\"resizehandleTR\").getBoundingClientRect();\r\n        var bl = document.getElementById(\"resizehandleBL\").getBoundingClientRect();\r\n        var br = document.getElementById(\"resizehandleBR\").getBoundingClientRect();\r\n        var mid = document.getElementById(\"resizehandleMID\").getBoundingClientRect();\r\n\r\n        const rect = {x: (tl.left + tl.right) / 2, y: (tl.top + tl.bottom) / 2, width: br.left - tl.left, height: br.top - tl.top}\r\n\r\n\r\n        this.setState({\r\n          rect\r\n        })\r\n\r\n        if(this.dist(p,{x: tl.left + .5 * tl.width - offsetLeft, y: tl.top + .5 * tl.width - offsetTop}) < tl.width / 2){\r\n          //console.log(\"tl\")\r\n          this.setState({\r\n            imageplacement: 'tl',\r\n          })\r\n        }\r\n        else if(this.dist(p,{x: tr.left + .5 * tr.width - offsetLeft, y: tr.top + .5 * tr.width - offsetTop}) < tr.width / 2){\r\n          //console.log(\"tr\")\r\n          this.setState({\r\n            imageplacement: 'tr',\r\n          })\r\n        }\r\n        else if(this.dist(p,{x: bl.left + .5 * bl.width - offsetLeft, y: bl.top + .5 * bl.width - offsetTop}) < bl.width / 2){\r\n          //console.log(\"bl\")\r\n          this.setState({\r\n            imageplacement: 'bl',\r\n          })\r\n        }\r\n        else if(this.dist(p,{x: br.left + .5 * br.width - offsetLeft, y: br.top + .5 * br.width - offsetTop}) < br.width / 2){\r\n          //console.log(\"br\")\r\n          this.setState({\r\n            imageplacement: 'br',\r\n          })\r\n        }\r\n        else if(this.dist(p,{x: mid.left + .5 * mid.width - offsetLeft, y: mid.top + .5 * mid.width - offsetTop}) < mid.width / 2){\r\n          //console.log(\"middle\");\r\n          this.setState({\r\n            imageplacement: 'mid',\r\n            moveref: {x: mid.left + .5 * mid.width - offsetLeft, y: mid.top + .5 * mid.width - offsetTop},\r\n          })\r\n        }\r\n        else if(tl.right - offsetLeft < p.x && p.x < br.left - offsetLeft && tl.bottom - offsetTop < p.y && p.y < br.top - offsetTop){\r\n          //console.log(\"place\");\r\n          this.setState({\r\n            imageplacement: 'place',\r\n          })\r\n        }\r\n\r\n      }\r\n      \r\n\r\n      this.setState({\r\n        pendown: true,\r\n        pointertrace: [p]\r\n      })\r\n\r\n      const ctx = this.canvRef.current.firstChild.firstChild.getContext('2d');\r\n\r\n      ctx.strokeStyle = this.getColor(this.props.initpenstate);\r\n      ctx.lineWidth = this.getPoint(this.props.initpenstate);\r\n      var penstate =this.props.initpenstate;\r\n\r\n      for(var i = 0; i < this.props.traces.length; i++){\r\n        if(this.props.traces[i].type === 'ui'){\r\n          penstate = {...penstate, ...this.props.traces[i].changes}\r\n          ctx.strokeStyle = this.getColor(penstate);\r\n          ctx.lineWidth = this.getPoint(penstate);\r\n        }\r\n      }\r\n    }\r\n  \r\n    pointerUpHandler(e) {\r\n      //delete displayed traces on canvas\r\n      console.log(this.props.penstate.point, this.props.penstate.color)\r\n      if(e.button===5 || e.button===2){\r\n        this.setState({\r\n          pendown: false,\r\n          pointertrace: [],\r\n          changes: {}\r\n        })\r\n        var deltrace = null;\r\n        var dist = 25;\r\n        for(var i = 0; i < this.props.displaytraces.length; i++){\r\n          var temp = this.props.traces.find(el => el.t === this.props.displaytraces[i].t && el.type === \"imgtrace\");\r\n          if(temp){\r\n            var trace = temp.trace;\r\n          } else {\r\n            continue;\r\n          }\r\n          var t = temp.t;\r\n          for(var j = 0; j < trace.length; j++){\r\n            var offsetX = this.canvRef.current.firstChild.getBoundingClientRect().x;\r\n            var offsetY = this.canvRef.current.firstChild.getBoundingClientRect().y;\r\n            var newdist = Math.pow(Math.pow((trace[j].x - e.clientX + offsetX),2) + Math.pow((trace[j].y - e.clientY + offsetY),2),.5)\r\n            if(newdist < dist){\r\n              deltrace = t;\r\n              dist = newdist;\r\n            }\r\n          }\r\n        }\r\n        if(deltrace !== null){\r\n          this.props.delTrace(deltrace)\r\n        }\r\n        return\r\n      }\r\n\r\n\r\n\r\n      if(this.state.spiralMode){\r\n        this.setState({\r\n          spiralMode: false\r\n        })\r\n      }\r\n      else if(this.state.imageplacement){\r\n        if(this.state.imageplacement === 'init'){\r\n          //console.log(\"setfalse\")\r\n          //this.setState({ imageplacement: false })\r\n          //TODO PLACE IMAGE ON CANVAS\r\n        }\r\n        else if(this.state.imageplacement === 'place'){\r\n          this.props.addImageTrace(this.state.pointertrace, this.state.transform);\r\n          this.setState({ \r\n            imageplacement: false,\r\n            transform: {type: 'mid', x:0, y:0},\r\n\r\n          })\r\n        }\r\n        else{\r\n          this.props.addImageTrace(this.state.pointertrace, this.state.transform)\r\n          this.setState({ \r\n            imageplacement: 'init',\r\n            transform: {type: 'mid', x:0, y:0},\r\n          })\r\n        }\r\n      }\r\n      else{\r\n        const ctx = this.canvRef.current.firstChild.firstChild.getContext('2d');\r\n        ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n        this.props.addTrace(this.state.pointertrace)\r\n      }\r\n      this.setState({\r\n        pendown: false,\r\n        pointertrace: []\r\n      })\r\n    }\r\n\r\n    drawalltraces(){\r\n\r\n      const ctx = this.canvRef.current.firstChild.firstChild.nextSibling.getContext('2d');\r\n      //const ctx = this.canvRef.getElementsByTagName('canvas')[1].getContext('2d');\r\n\r\n      ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n\r\n      let penstate = this.props.initpenstate;\r\n\r\n      ctx.strokeStyle = this.getColor(penstate);\r\n      ctx.lineWidth = this.getPoint(penstate);\r\n      if(penstate.linedash){\r\n        ctx.setLineDash([ctx.lineWidth, ctx.lineWidth]);\r\n      }\r\n      else{\r\n        ctx.setLineDash([])\r\n      }\r\n\r\n      if(penstate.end){\r\n          ctx.lineCap = \"round\"\r\n        }\r\n        else {\r\n          ctx.lineCap = \"butt\"\r\n        }\r\n\r\n        if(penstate.shadow){\r\n          ctx.shadowColor = this.getColor(penstate);\r\n          ctx.shadowOffsetX = 20;\r\n          ctx.shadowOffsetY = 20;\r\n          ctx.shadowBlur = 10;\r\n        }\r\n        else{\r\n          ctx.shadowColor = \"transparent\"\r\n        }\r\n\r\n      //temporary image data\r\n      var imgData;\r\n      var dX = 0;\r\n      var dY = 0;\r\n      var dWidth;\r\n      var dHeight;\r\n\r\n\r\n      for(var i = 0; i < this.props.traces.length; i++){\r\n\r\n          if(this.props.t + this.props.deltaT < this.props.traces[i].t){\r\n            return\r\n          }\r\n          if(this.props.traces[i].type === 'image'){\r\n            var current = true;\r\n            for(var j=i; j < this.props.traces.length; j++){\r\n              if(this.props.traces[j].type === 'imgtrace' || this.props.t + this.props.deltaT < this.props.traces[j].t){\r\n                \r\n              }\r\n              else{\r\n                current = false;\r\n                break;\r\n              }\r\n            }\r\n            if(current){\r\n              return\r\n            }else\r\n            imgData = this.props.traces[i].imgData;\r\n            dWidth = this.props.traces[i].width;\r\n            dHeight = this.props.traces[i].height;\r\n            dX = 0;\r\n            dY = 0;\r\n            continue\r\n          }\r\n          else if (this.props.traces[i].type === 'imgtrace') {\r\n            if(this.props.traces[i].transform.type === 'place'){\r\n\r\n              ctx.drawImage(imgData, dX, dY, dWidth, dHeight)\r\n            }\r\n            else {\r\n              //ctx.restore();\r\n              switch(this.props.traces[i].transform.type){\r\n                case('mid'):\r\n                  dX += this.props.traces[i].transform.x;\r\n                  dY += this.props.traces[i].transform.y;\r\n                  break;\r\n                case('tl'):\r\n                  dX += (1 - this.props.traces[i].transform.f1) * (dWidth)\r\n                  dY += (1 - this.props.traces[i].transform.f2) * (dHeight)\r\n                  dWidth *= this.props.traces[i].transform.f1;\r\n                  dHeight *= this.props.traces[i].transform.f2;\r\n                  break;\r\n                case('tr'):\r\n                  dY += (1-this.props.traces[i].transform.f2) * (dHeight);\r\n                  dWidth *= this.props.traces[i].transform.f1;\r\n                  dHeight *= this.props.traces[i].transform.f2;\r\n                  break;\r\n                case('bl'):\r\n                  dX += (1-this.props.traces[i].transform.f1) * (dWidth)\r\n                  dWidth *= this.props.traces[i].transform.f1;\r\n                  dHeight *= this.props.traces[i].transform.f2;\r\n                  break;\r\n                case('br'):\r\n                  dWidth *= this.props.traces[i].transform.f1;\r\n                  dHeight *= this.props.traces[i].transform.f2;\r\n                  break;\r\n              }\r\n            }\r\n            continue\r\n          }\r\n          else if(this.props.traces[i].type === 'ui'){\r\n            penstate = {...penstate, ...this.props.traces[i].changes}\r\n            ctx.strokeStyle = this.getColor(penstate);\r\n            ctx.lineWidth = this.getPoint(penstate);\r\n            if(penstate.linedash){\r\n              ctx.setLineDash([ctx.lineWidth, ctx.lineWidth]);\r\n            }\r\n            else{\r\n              ctx.setLineDash([])\r\n            }\r\n            if(penstate.end){\r\n              ctx.lineCap = \"round\"\r\n            }\r\n            else {\r\n              ctx.lineCap = \"butt\"\r\n            }\r\n    \r\n            if(penstate.shadow){\r\n              ctx.shadowColor = this.getColor(penstate)\r\n              ctx.shadowOffsetX = 20;\r\n              ctx.shadowOffsetY = 20;\r\n              ctx.shadowBlur = 10;\r\n            }\r\n            else{\r\n              ctx.shadowColor = \"transparent\"\r\n            }\r\n            continue\r\n          }\r\n\r\n          ctx.beginPath();\r\n          ctx.moveTo(this.props.traces[i].trace[0].x, this.props.traces[i].trace[0].y);\r\n\r\n          if(penstate.line){\r\n            ctx.lineTo(this.props.traces[i].trace[this.props.traces[i].trace.length - 1].x, this.props.traces[i].trace[this.props.traces[i].trace.length - 1].y)\r\n          }\r\n          else{\r\n            for (var j = 1; j < this.props.traces[i].trace.length; j++){\r\n                ctx.lineTo(this.props.traces[i].trace[j].x, this.props.traces[i].trace[j].y);\r\n            }\r\n          }\r\n          if(penstate.fill){\r\n            ctx.fillStyle = ctx.strokeStyle;\r\n            ctx.fill();\r\n          }\r\n          else{\r\n            ctx.stroke()\r\n          }\r\n      }\r\n    }\r\n  \r\n    pointerMoveHandler(e) {\r\n      \r\n      if(this.state.spiralMode && this.props.history === '3' && this.state.pointertrace.length > 3){\r\n        const mid = this.state.pointertrace[0];\r\n        var angle = 0;\r\n        for(var i = 2; i < this.state.pointertrace.length; i++){\r\n          \r\n          var angleDiff = this.angle(this.state.pointertrace[i-1], this.state.pointertrace[i], mid);\r\n          if(!isNaN(angleDiff)){\r\n            angle += angleDiff;\r\n          }\r\n        }\r\n        this.props.setDeltaT(this.state.deltaT-Math.floor(angle/Math.PI * 5));\r\n\r\n\r\n\r\n        var t = this.props.t + this.state.deltaT - Math.floor(angle/Math.PI * 5);\r\n        if(t !== this.state.spiralTempT){\r\n\r\n          var penstate = this.props.initpenstate;\r\n          for(var i = 1; i < this.props.traces.length; i++){\r\n            if(this.props.traces[i].t > t){\r\n              break\r\n            }\r\n            else if (this.props.traces[i].type === 'ui'){\r\n              penstate = {...penstate, ...this.props.traces[i].changes}\r\n            }\r\n          }\r\n          this.props.setPenstate(penstate)\r\n\r\n          this.setState({spiralTempT : t});\r\n        }\r\n\r\n        \r\n      }\r\n\r\n\r\n      if (this.state.pendown) {\r\n\r\n        const offsetTop = this.canvRef.current.firstChild.offsetTop + this.canvRef.current.parentElement.offsetTop;\r\n        const offsetLeft = this.canvRef.current.firstChild.offsetLeft + this.canvRef.current.parentElement.offsetLeft;\r\n        this.setState({\r\n          pointertrace: [...this.state.pointertrace, {x: e.clientX - offsetLeft, y: e.clientY - offsetTop}]\r\n        })\r\n\r\n        var tl = document.getElementById(\"resizehandleTL\").getBoundingClientRect();\r\n        var br = document.getElementById(\"resizehandleBR\").getBoundingClientRect();\r\n        var mid = document.getElementById(\"resizehandleMID\").getBoundingClientRect();\r\n        const rect = this.state.rect\r\n        var f1,f2;\r\n        switch(this.state.imageplacement){\r\n          case('init'):\r\n            this.pointerDownHandler(e);\r\n            break;\r\n          case('mid'):\r\n            this.setState({\r\n              transform: {type:'mid', x:e.clientX - offsetLeft - this.state.moveref.x, y:e.clientY - offsetTop - this.state.moveref.y},\r\n            })\r\n            break;\r\n          case('tl'):\r\n            f1 = Math.max(0,1 - ((e.clientX - rect.x)/ rect.width));\r\n            f2 = Math.max(0,1 - ((e.clientY - rect.y)/ rect.height));\r\n            this.setState({\r\n              transform: {f1, f2, type:'tl'} \r\n            })\r\n            break;\r\n          case('tr'):\r\n            f1 = Math.max(0,((e.clientX - rect.x)/ rect.width));\r\n            f2 = Math.max(0,1 - ((e.clientY - rect.y)/ rect.height));\r\n            this.setState({\r\n              transform: {f1, f2, type:'tr'} \r\n            })\r\n            break;\r\n          case('bl'):\r\n            f1 = Math.max(0,1 - ((e.clientX - rect.x)/ rect.width));\r\n            f2 = Math.max(0,((e.clientY - rect.y)/ rect.height));\r\n            this.setState({\r\n              transform: {f1, f2, type:'bl'} \r\n            })\r\n            break;\r\n          case('br'):\r\n            f1 = Math.max(0,(e.clientX - rect.x)/ rect.width);\r\n            f2 = Math.max(0,(e.clientY - rect.y)/ rect.height);\r\n            this.setState({\r\n              transform: {f1, f2, type:'br'} //(-1 + factor1) * rect.width / 2, (-1 + factor2) * rect.height / 2\r\n            })\r\n            break;\r\n          case('place'):\r\n            this.setState({\r\n              transform: {type: 'place'}\r\n            })\r\n        }\r\n      }\r\n    }\r\n\r\n    getColor(penstate){\r\n        var newcolor = penstate.color.slice(0,7)\r\n        if(penstate.alpha * 255 < 17){\r\n            newcolor = newcolor + \"0\" + Math.floor(penstate.alpha*255).toString(16);\r\n        }\r\n        else {\r\n            newcolor = newcolor + Math.floor(penstate.alpha*255).toString(16);\r\n        }\r\n        return newcolor;\r\n    }\r\n\r\n    getPoint(penstate){\r\n        return penstate.point * 50;\r\n    }\r\n\r\n    getMatrixString(matrix){\r\n      return 'matrix(' + matrix[0] + ',' + matrix[1] + ',' + matrix[2] + ',' + matrix[3] + ',' + matrix[4] + ',' + matrix[5] + ')';\r\n    }\r\n\r\n    addImage(e){\r\n\r\n      var file = e.target.files[0]\r\n      \r\n      //TODO fix\r\n      if(this.state.imageplacement){\r\n        alert(\"Cannot upload file during imageplacement\")\r\n        return\r\n      }\r\n      if(!file){\r\n        return\r\n      }\r\n      if(file.type.slice(0,5) !== \"image\"){\r\n        alert(\"file is not an image\")\r\n        return\r\n      }\r\n      const reader = new FileReader()\r\n      //var img = new Image()\r\n      var img = document.createElement('img');\r\n      img.src = e.target.files[0]\r\n      var addthis = this\r\n\r\n      var onload1 = false;\r\n      var onload2 = false;\r\n      var w,h;\r\n\r\n      img.src = e.target.files[0];\r\n\r\n      reader.addEventListener(\"load\", async function () {\r\n      // convert image file to base64 string\r\n\r\n        img.src = reader.result;\r\n        onload2 = true;\r\n\r\n        img.addEventListener('load', async function() {\r\n          w = img.width;\r\n          h = img.height;\r\n          addthis.placeImage(img,w,h);\r\n        });\r\n\r\n        }, false);\r\n\r\n        if (file) {\r\n          reader.readAsDataURL(file);\r\n      }\r\n\r\n    }\r\n\r\n    placeImage(img, w, h){\r\n\r\n      this.setState({\r\n        imageplacement: 'init'\r\n      })\r\n\r\n\r\n      this.setState({\r\n        imgheight: h,\r\n        imgwidth: w,\r\n      })\r\n      this.props.addImage(img, h, w)\r\n\r\n      //transform: {f1, f2, type:'tl'} \r\n\r\n      //const parent = this.canvRef.current.firstChild;\r\n\r\n      // var div = document.createElement('div')\r\n      // var div2 = document.createElement('div')\r\n      // // var top = (this.state.containerheight - 600 - 20)/2 + 20;\r\n      // // var left = (this.state.containerwidth - 600 - 20)/2 + 20;\r\n\r\n      // div.style.position = 'absolute'\r\n      // // div.style.top = top + 'px';\r\n      // // div.style.left = left + 'px';\r\n      // div.style.zIndex = 19;\r\n      // div.style.transformOrigin = \"top left\"\r\n\r\n      // div2.appendChild(img);\r\n      // div.appendChild(div2);\r\n\r\n      // const resizersize = 50\r\n\r\n      // const resize1 = document.createElement('div');\r\n      // const resize2 = document.createElement('div');\r\n      // const resize3 = document.createElement('div');\r\n      // const resize4 = document.createElement('div');\r\n      // const resize5 = document.createElement('div');\r\n      // const resize6 = document.createElement('div');\r\n\r\n      // resize1.style.position = \"absolute\"\r\n      // resize1.className = \"resizeEl\"\r\n      // resize1.style.borderRadius = \"50%\"\r\n      // resize1.style.height = resizersize + \"px\"\r\n      // resize1.style.width = resizersize + \"px\"\r\n      // resize1.style.background = \"cyan\"\r\n      // resize1.style.opacity = \"40%\"\r\n      \r\n      \r\n\r\n      // var cssForAll = resize1.style.cssText;\r\n\r\n      // resize1.style.top = -.5*resizersize + \"px\"\r\n      // resize1.style.left = -.5*resizersize + \"px\"\r\n\r\n      // resize2.style.cssText = cssForAll\r\n      // resize2.style.top = -.5*resizersize + \"px\"\r\n      // resize2.style.right = -.5*resizersize + \"px\"\r\n\r\n      // resize3.style.cssText = cssForAll\r\n      // resize3.style.bottom = -.5*resizersize  + 4 + \"px\"\r\n      // resize3.style.right = -.5*resizersize + \"px\"\r\n\r\n      // resize4.style.cssText = cssForAll;\r\n      // resize4.style.bottom = -.5*resizersize + 4 + \"px\";\r\n      // resize4.style.left = -.5*resizersize + \"px\";\r\n\r\n      // resize5.style.cssText = cssForAll;\r\n      // resize5.style.top = \"calc(50% - \"+ .5 * resizersize + \"px)\";\r\n      // resize5.style.left = \"calc(50% - \"+ .5 * resizersize + \"px)\";\r\n\r\n      // resize6.style.cssText = cssForAll;\r\n      // resize6.style.top = \"calc(50% - \"+ .5 * resizersize + \"px)\";\r\n      // resize6.style.left = \"calc(75% - \"+ .5 * resizersize + \"px)\";\r\n\r\n\r\n      //div.appendChild(resize1);\r\n      //div.appendChild(resize2);\r\n      //div.appendChild(resize3);\r\n      //div.appendChild(resize4);\r\n      //div.appendChild(resize5);\r\n      //div.appendChild(resize6);\r\n\r\n      \r\n\r\n      //parent.appendChild(div);\r\n\r\n\r\n    }\r\n\r\n    displaytraces(){\r\n      const ctx = this.canvRef.current.firstChild.firstChild.getContext('2d');\r\n      //ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n      for(var i = 0; i < this.props.displaytraces.length; i++){\r\n        var tmp = this.props.traces.find(el => el.t === this.props.displaytraces[i].t && el.type === \"imgtrace\")\r\n        if(tmp){\r\n          this.drawtrace(ctx, tmp.trace, this.props.displaytraces[i].alpha);\r\n        }\r\n      }\r\n    }\r\n\r\n    drawtrace(ctx, trace, alpha){\r\n      ctx.strokeStyle = \"rgba(0, 0, 0, \" + alpha + \")\";\r\n      ctx.lineWidth = 1;\r\n      ctx.beginPath();\r\n      ctx.moveTo(trace[0].x, trace[0].y);\r\n  \r\n      for(var i = 1; i < trace.length; i++){\r\n        ctx.lineTo(trace[i].x,trace[i].y);\r\n      }\r\n      ctx.stroke();\r\n    }\r\n\r\n    render(){\r\n        return(\r\n          <div \r\n          id=\"canvasInteractionDiv\" \r\n          ref={this.canvRef} \r\n          onPointerDown={this.pointerDownHandler.bind(this)} \r\n          onPointerUp={this.pointerUpHandler.bind(this)} \r\n          onPointerMove={this.pointerMoveHandler.bind(this)} \r\n          onContextMenu={(e)=>  {e.preventDefault(); return false;}}\r\n          >\r\n              <div id=\"innerCanvasContainer\">\r\n                <canvas id=\"drawing-canvas\" \r\n                height={this.getSize().y}\r\n                width={this.getSize().x}\r\n                />\r\n\r\n                <canvas id=\"drawing-canvas2\" \r\n                height={this.getSize().y} \r\n                width={this.getSize().x} \r\n                />\r\n                <div id = \"resizehandleTL\" className=\"resizeHandle\"></div>\r\n                <div id = \"resizehandleTR\" className=\"resizeHandle\"></div>\r\n                <div id = \"resizehandleBL\" className=\"resizeHandle\"></div>\r\n                <div id = \"resizehandleBR\" className=\"resizeHandle\"></div>\r\n                <div id = \"resizehandleMID\" className=\"resizeHandle\"></div>\r\n              </div>\r\n\r\n              <Topruler/>\r\n              <Sideruler/>\r\n              <Drawingsample />\r\n\r\n\r\n\r\n              <input type=\"file\" id=\"fileupload\" name=\"file\" onChange={this.addImage.bind(this)}/>\r\n              <label for=\"fileupload\">\r\n                <canvas height=\"100\" width=\"100\"></canvas>\r\n              </label>\r\n          </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n      traces: state.traces,\r\n      displaytraces: state.displaytraces,\r\n      initpenstate: state.initpenstate,\r\n      penstate: state.penstate,\r\n      t:state.t,\r\n      uicolor: state.uicolor,\r\n      deltaT: state.deltaT\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return {\r\n      addTrace: (pointertrace) => { dispatch({type: 'ADD_DRAWTRACE', trace: pointertrace}) },\r\n      addImage: (image, height, width) => { dispatch({type: 'ADD_IMAGE', imgData: image, height, width}) },\r\n      addImageTrace: (imagetrace, transform) => { dispatch ({ type : 'ADD_IMAGETRACE', trace: imagetrace, transform: transform }) },\r\n      setDeltaT: (deltaT) => { dispatch ({ type: 'DELTA_T', deltaT}) },\r\n      setPenstate: (val) => { dispatch({type: 'SET_PENSTATE', update:val}) },\r\n      delTrace: (t) => { dispatch({type: 'DEL_UITRACE', t: t}) },\r\n    }\r\n}\r\n  \r\nexport default connect(mapStateToProps, mapDispatchToProps)(Canvas);","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\n\r\nclass Historybar extends Component {\r\n  state = {\r\n      numOfEls: 10,\r\n      pentrace: [],\r\n      pendown : false,\r\n      selected: [],\r\n      temptrace : false,\r\n      selectedtraces: [],\r\n  }\r\n\r\n  constructor(props){\r\n      super(props);\r\n      this.canvRef = React.createRef();\r\n  }\r\n\r\n  getSize(){\r\n    return {x: this.state.width, y: this.state.height}\r\n  }\r\n\r\n  getUItraceList(){\r\n    return this.props.traces.filter(el => el.type === 'ui' || (el.type === 'imgtrace' && el.transform.type !== 'place')).slice(-this.state.numOfEls)\r\n  }\r\n\r\n  componentDidMount(){\r\n    var height = document.getElementById('historybar-canvas').clientHeight;\r\n    var width = document.getElementById('historybar-canvas').clientWidth;\r\n    this.setState({\r\n      height: height,\r\n      width: width,\r\n      numOfEls: (Math.floor((width - 20) / 120))\r\n    })\r\n  }\r\n\r\n  drawHistory(){\r\n    var uitracelist = this.getUItraceList();\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    ctx.canvas.width  = this.getSize().x;\r\n    ctx.canvas.height = this.getSize().y;\r\n    ctx.clearRect(0, 0, this.getSize().x, this.getSize().y);\r\n\r\n    ctx.strokeStyle = this.props.uicolor;\r\n\r\n    var offsetX = 120;\r\n    var i,j;\r\n\r\n    for(i = 0; i < uitracelist.length; i++){\r\n\r\n      ctx.fillStyle = this.props.uicolor;\r\n      ctx.textAlign = \"center\"; \r\n      ctx.font = \"15px Tahoma\"\r\n      ctx.textAlign = \"center\";\r\n\r\n      if(i+1 == uitracelist.length){\r\n        ctx.fillText(\"t\", 10 + 60 + 120*i, 20); \r\n      }\r\n      else{\r\n        ctx.fillText(\"t - \" + (uitracelist.length - i - 1), 10 + 60 + 120*i, 20); \r\n      }\r\n      \r\n      if(uitracelist[i].type === \"ui\"){\r\n        ctx.font = \"10px Tahoma\"\r\n        ctx.textAlign = \"end\"; \r\n\r\n        const text = Array.from(Object.keys(uitracelist[i].changes));\r\n        for(var k = 0; k < text.length; k++){\r\n           ctx.fillText(text[k], 10 + 100 + 120*i, 180 - 12*k);\r\n        }\r\n        ctx.beginPath();\r\n        ctx.moveTo(uitracelist[i].trace[0].x / 4 + 25 + offsetX * i, uitracelist[i].trace[0].y / 4 + 22);\r\n\r\n        for(j = 0; j < uitracelist[i].trace.length; j++){\r\n            ctx.lineTo(uitracelist[i].trace[j].x / 4 + 25 + offsetX * i, uitracelist[i].trace[j].y / 4 + 22);\r\n        }\r\n        ctx.stroke();\r\n      }\r\n      else if(uitracelist[i].type === \"imgtrace\"){\r\n        ctx.font = \"10px Tahoma\";\r\n        ctx.textAlign = \"end\";\r\n        const text = uitracelist[i].transform.type\r\n        var printtext\r\n        switch(text){\r\n          case(\"tl\"):\r\n            printtext = \"resize: top left\";\r\n            break;\r\n          case(\"tr\"):\r\n            printtext = \"resize: top right\";\r\n            break;\r\n          case(\"bl\"):\r\n            printtext = \"resize: bottom left\";\r\n            break;\r\n          case(\"br\"):\r\n            printtext = \"resize: bottom right\";\r\n            break;\r\n          case(\"mid\"):\r\n            printtext = \"move\";\r\n            break;\r\n        }\r\n        ctx.fillText(printtext, 10 + 100 + 120*i, 180);\r\n\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(uitracelist[i].trace[0].x / 6 + 25 + offsetX * i, 30 + uitracelist[i].trace[0].y / 6 + 22);\r\n\r\n        for(j = 0; j < uitracelist[i].trace.length; j++){\r\n            ctx.lineTo(uitracelist[i].trace[j].x / 6 + 25 + offsetX * i, 30 + uitracelist[i].trace[j].y / 6 + 22);\r\n        }\r\n        ctx.stroke();\r\n      }\r\n    }\r\n\r\n    //drawselection\r\n    ctx.fillStyle = \"#3297FD22\"\r\n    for(i = 0; i < uitracelist.length; i++){\r\n      //var insert = false\r\n      for(j = 0; j < this.state.selectedtraces.length; j++){\r\n        if(uitracelist[i].t === this.state.selectedtraces[j].t){\r\n          ctx.fillRect(20 + 120 * i, 30, 100, 160)\r\n        }\r\n      }\r\n    }\r\n\r\n    ctx.moveTo(10,30);\r\n    ctx.lineTo(10, this.getSize().y - 10);\r\n    ctx.lineTo(10 + uitracelist.length * 120, this.getSize().y - 10);\r\n    ctx.lineTo(10 + uitracelist.length * 120, 30);\r\n    ctx.lineTo(10,30);\r\n    ctx.stroke();\r\n\r\n  }\r\n\r\n  componentDidUpdate(){\r\n    var penstate = this.props.initpenstate;\r\n\r\n    // for(var i = 0; i < this.props.traces.length; i++){\r\n    //   if(this.props.traces[i].type === 'ui'){\r\n    //     penstate = {...penstate, ...this.props.traces[i].changes}\r\n    //   }\r\n    // }\r\n    // if(penstate){\r\n    //   this.props.setPenstate(penstate)\r\n    // }\r\n    // else{\r\n    //   this.props.setInit()\r\n    // }\r\n\r\n    //drawing the pentrace\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    if(this.state.pentrace.length > 0){\r\n      ctx.beginPath();\r\n      ctx.moveTo(this.state.pentrace[0].x, this.state.pentrace[0].y)\r\n      for(var i = 1; i < this.state.pentrace.length; i++){\r\n        ctx.lineTo(this.state.pentrace[i].x, this.state.pentrace[i].y)\r\n      }\r\n      ctx.stroke()\r\n    }\r\n\r\n    if(!this.state.pendown){\r\n      this.drawHistory()\r\n    }\r\n  }\r\n\r\n  pointerDownHandler(event){\r\n    //console.log(event.button)\r\n    if(event.button === 5 || event.button===2){\r\n    }\r\n    else{\r\n\r\n      var offsetX = this.canvRef.current.getBoundingClientRect().x;\r\n      var offsetY = this.canvRef.current.getBoundingClientRect().y;\r\n\r\n      this.setState({\r\n        pentrace: [{x: event.clientX - offsetX,y: event.clientY - offsetY}],\r\n        pendown: true\r\n      })\r\n    }\r\n  }\r\n\r\n  pointerUpHandler(event){\r\n    var uitracelist = this.getUItraceList()\r\n    if((event.button === 5 || event.button===2) && event.clientX % 120 > 20 && event.clientX / 120 <= this.getUItraceList().length){\r\n        //this.props.clrDisplaytrace()\r\n        this.props.delTrace(uitracelist[Math.floor(event.clientX / 120)].t)\r\n    }\r\n    else{\r\n      if(this.state.pentrace.length > 1){\r\n        //for selection by circle\r\n        //if(this.dist(this.state.pentrace[0], this.state.pentrace[this.state.pentrace.length-1]) < 40){\r\n          var selectedtraces = this.interpretTrace(this.state.pentrace).map(x => ({t: x, alpha: 1}));\r\n\r\n          this.setState({\r\n            selectedtraces,\r\n            pentrace: [],\r\n            pendown: false\r\n          })\r\n        //}\r\n        // else{\r\n        //   this.setState({\r\n        //     pentrace: [],\r\n        //     pendown: false\r\n        //   })\r\n        //}\r\n      }\r\n    }\r\n  }\r\n\r\n  pointerMoveHandler(event){\r\n    //error on my surface i don't know why this happens\r\n    if(170 < event.clientX && event.clientX < 171 && 702 < event.clientY && event.clientY < 703){\r\n      return\r\n    }\r\n\r\n    var rect = this.canvRef.current.getBoundingClientRect()\r\n    if(!this.state.pendown){\r\n      if(event.clientY > rect.top && event.clientX % 120 > 20 && event.clientX / 120 <= this.getUItraceList().length){             \r\n\r\n        var uitracelist = this.getUItraceList();\r\n        var temptrace = uitracelist[Math.floor(event.clientX / 120)].t\r\n        this.setState({\r\n          temptrace\r\n        })\r\n        this.props.setDisplaytraces([...this.state.selectedtraces, {t: temptrace, alpha:1}])\r\n      }\r\n    }\r\n\r\n    if(event.button === 5 || event.button===2){\r\n    }\r\n    else{\r\n      if(this.state.pendown){\r\n        var offsetX = this.canvRef.current.getBoundingClientRect().x;\r\n        var offsetY = this.canvRef.current.getBoundingClientRect().y;\r\n\r\n        this.setState({\r\n          pentrace: [...this.state.pentrace, {x: event.clientX - offsetX,y: event.clientY - offsetY}]\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  pointerOutHandler(event){\r\n    this.pointerUpHandler(event);\r\n    this.setState({\r\n      temptrace: null\r\n    })\r\n    this.props.setDisplaytraces(this.state.selectedtraces)\r\n    //this.props.clrDisplaytrace();\r\n  }\r\n\r\n  dist(a,b){\r\n    return Math.pow(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2), .5);\r\n  }\r\n\r\n  interpretTrace(trace) {\r\n    var arr = new Array(this.state.numOfEls).fill(0)\r\n\r\n    for(var i = 0; i < trace.length; i++){\r\n      if(trace[i].y > 30 && trace[i].y < this.getSize().y - 10)\r\n        for(var j = 0; j < this.state.numOfEls; j++){\r\n          if(trace[i].x > 20 + 120 * j && trace[i].x < 120 + j * 120){\r\n            arr[j]++\r\n            break\r\n          }\r\n      }\r\n    }\r\n\r\n    var threshold = 1;\r\n    var temp = arr.map(x => x > threshold);\r\n\r\n    var result = []\r\n    var uitrace = this.getUItraceList();\r\n\r\n    for(i = 0; i < uitrace.length; i++){\r\n\r\n      if(temp[i]){\r\n        result.push(uitrace[i].t)\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n    <canvas id=\"historybar-canvas\" \r\n    ref={this.canvRef} \r\n    height={this.getSize.bind(this).y} \r\n    width={this.getSize.bind(this).x} \r\n    onContextMenu={(e)=>  {e.preventDefault(); return false;}}\r\n    onPointerDown={this.pointerDownHandler.bind(this)} \r\n    onPointerUp={this.pointerUpHandler.bind(this)} \r\n    onPointerMove={this.pointerMoveHandler.bind(this)}\r\n    onPointerOut={this.pointerOutHandler.bind(this)}\r\n    ></canvas>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    return {\r\n      traces: state.traces,\r\n      uicolor: state.uicolor\r\n    }\r\n  }\r\n\r\n  const mapDispatchToProps = dispatch => {\r\n    return {\r\n      delTrace: (t) => { dispatch({type: 'DEL_UITRACE', t: t}) },\r\n      setPenstate: (val) => { dispatch({type: 'SET_PENSTATE', update:val}) },\r\n      setInit: () => { dispatch({type: 'SET_INIT'}) },\r\n      addDisplaytrace: (t,alpha) => { dispatch({type: 'ADD_DISPLAYTRACE', t: t, alpha: alpha}) },\r\n      setDisplaytraces: (list) => { dispatch({ type: 'SET_DISPLAYTRACES', list})},\r\n      clrDisplaytraces: () => { dispatch({type: 'CLR_DISPLAYTRACES'}) },\r\n      clrDisplaytrace: (t) => { dispatch({type: 'CLR_DISPLAYTRACE', t}) },\r\n    }\r\n  }\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Historybar);\r\n ","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nclass Historyselector extends Component {\r\n  state = {\r\n      selectedOption: '0',\r\n      pointertrace: [],\r\n  }\r\n\r\n  constructor(props){\r\n      super(props);\r\n      this.setHistory = props.setHistory\r\n      this.canvRef = React.createRef();\r\n  }\r\n\r\n  componentDidMount(){\r\n    this.drawComponent();\r\n  }\r\n\r\n  componentDidUpdate(){\r\n    this.drawComponent();\r\n\r\n    const ctx = this.canvRef.current.getContext('2d')\r\n\r\n    if(this.state.pointertrace.length > 0){\r\n      ctx.beginPath();\r\n      ctx.strokeStyle = this.props.uicolor;\r\n      ctx.moveTo(this.state.pointertrace[0].x, this.state.pointertrace[0].y)\r\n      for(var i = 1; i < this.state.pointertrace.length; i++){\r\n        ctx.lineTo(this.state.pointertrace[i].x, this.state.pointertrace[i].y)\r\n      }\r\n    }\r\n    ctx.stroke()\r\n\r\n\r\n  }\r\n\r\n  drawComponent(){\r\n    const ctx = this.canvRef.current.getContext('2d')\r\n    //const delX = 70;\r\n    ctx.clearRect(0,0,350,40)\r\n    for(var i = 0; i < 4; i++){\r\n      ctx.strokeStyle = this.props.uicolor;\r\n      ctx.beginPath();\r\n      ctx.arc(15 + i * 70 + 70, 20, 10, 0, 2 * Math.PI);\r\n      ctx.rect(32 + i * 70 + 70, 5, 30, 30);\r\n      ctx.stroke();\r\n    }\r\n    ctx.beginPath();\r\n    ctx.moveTo(32 + 70,5);\r\n    ctx.lineTo(62 + 70,35);\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.rect(102 + 70,25,30,10);\r\n    ctx.fillStyle = this.props.uicolor;\r\n    ctx.fill();\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(247,10)\r\n    ctx.lineTo(267,10)\r\n    ctx.lineTo(267,30)\r\n    ctx.lineTo(247,30)\r\n    ctx.lineTo(247,10)\r\n\r\n    ctx.moveTo(247,10)\r\n    ctx.lineTo(267,30)\r\n    ctx.moveTo(267,10)\r\n    ctx.lineTo(247,30)\r\n    ctx.stroke()\r\n    //was button\r\n    // ctx.beginPath();\r\n    // ctx.arc(187 + 70, 20, 8, 0, 2 * Math.PI);\r\n    // ctx.fill();\r\n\r\n    ctx.beginPath();\r\n\r\n    for (i=0; i< 130; i++) {\r\n      var angle = 0.1 * i;\r\n      var x= 257 + 70 + (1+angle)*Math.cos(angle);\r\n      var y= 20 + (1+angle)*Math.sin(angle);\r\n      ctx.lineTo(x, y);\r\n    }\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.arc(15  + 70 + this.state.selectedOption * 70, 20, 6, 0, 2 * Math.PI);\r\n    ctx.fill();\r\n  }\r\n\r\n  pointerDownHandler(e){\r\n    var p = {x: e.clientX - this.canvRef.current.getBoundingClientRect().x,y: e.clientY - this.canvRef.current.getBoundingClientRect().y};\r\n    this.setState({\r\n      pointertrace: [p],\r\n      pendown: true\r\n    })\r\n\r\n    for(var i = 0; i < 4; i++){\r\n      if(this.dist(p, {x: 10 + 70*i + 70, y: 20}) < 10){\r\n        this.setState({selectedOption : i})\r\n        this.props.clrDisplaytraces();\r\n        this.setHistory(i.toString());\r\n        break;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  pointerUpHandler(e){\r\n    this.setState({\r\n      pointertrace: [],\r\n      pendown: false,\r\n    })\r\n  }\r\n\r\n  pointerMoveHandler(e){\r\n    if(this.state.pendown){\r\n      var p = {x: e.clientX - this.canvRef.current.getBoundingClientRect().x,y: e.clientY - this.canvRef.current.getBoundingClientRect().y};\r\n      this.setState({\r\n        pointertrace: [...this.state.pointertrace, p],\r\n      })\r\n  \r\n      for(var i = 0; i < 4; i++){\r\n        if(this.dist(p, {x: 10 + 70*i + 70, y: 20}) < 10){\r\n          this.setState({selectedOption : i})\r\n          this.props.clrDisplaytraces();\r\n          this.setHistory(i.toString())\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  dist(a,b){\r\n    return Math.pow(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2), .5);\r\n  }\r\n  \r\n  handleOptionChange(changeEvent) {\r\n    this.setState({\r\n      selectedOption: changeEvent.target.value\r\n    });\r\n    this.setHistory(changeEvent.target.value)\r\n  }\r\n\r\n  render() {\r\n    return (\r\n        <canvas \r\n        ref={this.canvRef} \r\n        id=\"historyselector\"\r\n        height=\"40px\" \r\n        width=\"350px\"\r\n        onPointerDown={this.pointerDownHandler.bind(this)} \r\n        onPointerUp={this.pointerUpHandler.bind(this)} \r\n        onPointerMove={this.pointerMoveHandler.bind(this)}\r\n        />\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n      uicolor: state.uicolor,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    clrDisplaytraces: () => { dispatch({type: 'CLR_DISPLAYTRACES'}) },\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Historyselector);\r\n","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux'\r\n\r\nclass Button extends Component {\r\n  state={\r\n    numOfEls: 5,\r\n    pointertrace: []\r\n  }\r\n\r\n  constructor(props) {\r\n        super(props);\r\n        this.canvRef = React.createRef();\r\n        this.handleInputChange = this.handleInputChange.bind(this);\r\n  }\r\n    \r\n  handleInputChange(event) {\r\n        const target = event.target;\r\n        const value = target.name === 'historybox' ? target.checked : target.value;\r\n        const name = target.name;\r\n        this.setState({\r\n          [name]: value\r\n        });\r\n        \r\n  }\r\n\r\n  componentDidUpdate(){\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n\r\n    ctx.clearRect(0,0,100,100);\r\n\r\n    this.drawComponent()\r\n\r\n    if(this.state.pointertrace.length > 0){\r\n      ctx.beginPath();\r\n      ctx.moveTo(this.state.pointertrace[0].x, this.state.pointertrace[0].y)\r\n      for(var i = 1; i < this.state.pointertrace.length; i++){\r\n        ctx.lineTo(this.state.pointertrace[i].x, this.state.pointertrace[i].y)\r\n      }\r\n    }\r\n    ctx.stroke()\r\n\r\n\r\n    // var penstate =this.props.initpenstate;\r\n\r\n    // for(var i = 0; i < this.props.traces.length; i++){\r\n    //   if(this.props.traces[i].type === 'ui'){\r\n    //     penstate = {...penstate, ...this.props.traces[i].changes}\r\n    //   }\r\n    // }\r\n    // if(penstate){\r\n    //   this.props.setPenstate(penstate)\r\n    // }\r\n    // else{\r\n    //   this.props.setInit()\r\n    // }\r\n\r\n    this.props.clrDisplaytraces();\r\n    if(this.state.historybox){\r\n      var uitracelist = this.getUItraceList()\r\n      for(i = 0; i < uitracelist.length; i++){\r\n        this.props.addDisplaytrace(uitracelist[i].t, 1)//(6-uitracelist.length)*.2 + .2*i);\r\n      }\r\n    }\r\n    else{\r\n\r\n    }\r\n  }\r\n\r\n  componentDidMount(){\r\n    this.drawComponent()\r\n  }\r\n\r\n  drawComponent(){\r\n    const ctx = this.canvRef.current.getContext('2d');\r\n    ctx.strokeStyle = this.props.uicolor;\r\n    ctx.beginPath();\r\n    ctx.rect(50,50,40,40);\r\n\r\n    if(this.state.historybox){\r\n      ctx.moveTo(50,50);\r\n      ctx.lineTo(90,90);\r\n      ctx.moveTo(90,50);\r\n      ctx.lineTo(50,90);\r\n    }\r\n    ctx.stroke();\r\n\r\n    ctx.fillStyle = this.props.uicolor;\r\n    ctx.font = \"12px Tahoma\";\r\n    ctx.textAlign = \"end\";\r\n    ctx.fillText(\"Display\", 40, 67);\r\n    ctx.fillText(\"Traces\", 40, 85);\r\n\r\n  }\r\n  \r\n  getUItraceList(){\r\n    return this.props.traces.filter(el => el.type === 'ui' || (el.type === 'imgtrace' && el.transform.type !== 'place'))//.slice(-this.state.numOfEls-1)\r\n  }\r\n\r\n  pointerDownHandler(e){\r\n    var p = {x: e.clientX - this.canvRef.current.getBoundingClientRect().x,y: e.clientY - this.canvRef.current.getBoundingClientRect().y};\r\n    this.setState({\r\n      pointertrace: [p],\r\n      pendown: true\r\n    })\r\n  }\r\n\r\n  pointerUpHandler(e){\r\n    //console.log(this.state.pointertrace)\r\n    var p = {x: e.clientX - this.canvRef.current.getBoundingClientRect().x,y: e.clientY - this.canvRef.current.getBoundingClientRect().y};\r\n    var p1 = {x:50,y:50}\r\n    var p2 = {x:90,y:90}\r\n    if(this.state.pointertrace.length < 4 && this.inBox(p,p1,p2)){\r\n      var value = !this.state.historybox;\r\n      //console.log(value)\r\n      this.setState({\r\n        historybox: value\r\n      });\r\n    }\r\n    this.setState({\r\n      pointertrace: [],\r\n      pendown: false,\r\n    })\r\n  }\r\n\r\n  pointerMoveHandler(e){\r\n    if(this.state.pendown){\r\n      var p = {x: e.clientX - this.canvRef.current.getBoundingClientRect().x,y: e.clientY - this.canvRef.current.getBoundingClientRect().y};\r\n\r\n      var p1 = {x:50,y:50}\r\n      var p2 = {x:90,y:90}\r\n\r\n      if(this.state.pointertrace.length > 0 && !this.inBox(this.state.pointertrace[this.state.pointertrace.length - 1],p1,p2) && this.inBox(p,p1,p2)){\r\n        var value = !this.state.historybox;\r\n        //console.log(value)\r\n        this.setState({\r\n          historybox: value\r\n        });\r\n      }\r\n\r\n      this.setState({\r\n        pointertrace: [...this.state.pointertrace, p],\r\n      })\r\n    }\r\n  }\r\n\r\n  dist(a,b){\r\n    return Math.pow(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2), .5);\r\n  }\r\n\r\n  inBox(val, p1, p2){\r\n    return val.x > p1.x && val.y > p1.y && val.x < p2.x && val.y < p2.y;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n        <div id=\"historybox\">\r\n          <canvas\r\n          height=\"100px\"\r\n          width=\"100px\"\r\n          ref={this.canvRef} \r\n          onPointerDown={this.pointerDownHandler.bind(this)} \r\n          onPointerUp={this.pointerUpHandler.bind(this)} \r\n          onPointerMove={this.pointerMoveHandler.bind(this)}\r\n          ></canvas>\r\n            {/* <form>\r\n                <label>\r\n                showHistory\r\n                    <input\r\n                        name=\"historybox\" type=\"checkbox\"\r\n                        checked={this.state.isGoing}\r\n                        onChange={this.handleInputChange}\r\n                    />\r\n                </label>\r\n            </form> */}\r\n        </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  return {\r\n    traces: state.traces,\r\n    initpenstate: state.initpenstate,\r\n    uicolor: state.uicolor\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    addTrace: (pointertrace) => { dispatch({type: 'ADD_DRAWTRACE', trace: pointertrace}) },\r\n    addDisplaytrace: (t,alpha) => { dispatch({type: 'ADD_DISPLAYTRACE', t: t, alpha: alpha}) },\r\n    clrDisplaytraces: () => { dispatch({type: 'CLR_DISPLAYTRACES'}) },\r\n    setPenstate: (val) => { dispatch({type: 'SET_PENSTATE', update:val}) },\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Button);","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar SvgTimestroke = function SvgTimestroke(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 400 100\",\n    xmlSpace: \"preserve\",\n    style: {\n      fillRule: \"evenodd\",\n      clipRule: \"evenodd\",\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\",\n      strokeMiterlimit: 1.5\n    },\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(6.12323e-17,1,-1,6.12323e-17,389.702,-390.097)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M440.097,6.434L483.076,92.393L397.118,92.393L440.097,6.434Z\",\n    style: {\n      fill: \"white\",\n      stroke: \"black\",\n      strokeWidth: \"8.96px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1,0,0,1,3.99745,2.13163e-14)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M91.823,7.021L91.823,92.979L34.224,92.979C22.364,92.979 12.735,83.35 12.735,71.49L12.735,28.51C12.735,16.65 22.364,7.021 34.224,7.021L91.823,7.021Z\",\n    style: {\n      stroke: \"black\",\n      strokeWidth: \"8.96px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1,0,0,1,-37.9266,3.55271e-15)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M171.247,7.021L238.773,50L171.247,92.979L148.794,92.979L148.794,7.021L171.247,7.021Z\",\n    style: {\n      stroke: \"black\",\n      strokeWidth: \"8.96px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1,0,0,1,-37.9266,3.55271e-15)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M230.228,50L297.755,7.021L320.208,7.021L320.208,92.979L297.755,92.979L230.228,50Z\",\n    style: {\n      fill: \"white\",\n      stroke: \"black\",\n      strokeWidth: \"8.96px\"\n    }\n  })));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgTimestroke, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/Timestroke.8872ecb8.svg\";\nexport { ForwardRef as ReactComponent };","import React, { Component } from 'react';\r\nimport {ReactComponent as TimestrokeLogo} from './svg/Timestroke.svg'\r\n\r\n\r\nconst fontSpecs = {\r\n    fontFamily: undefined,\r\n    fontSize: 26,\r\n    fontStyle: 'italic',\r\n    fontWeight: 'bold',\r\n  }\r\n\r\nclass Topbar extends Component{\r\n\r\n\r\n    render(){\r\n        return(\r\n            <div id=\"topbar\">\r\n                <TimestrokeLogo id=\"logo\"/>\r\n                <p id=\"title\" style={fontSpecs}>Timestroke Drawing Application</p>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default Topbar;","import React, { Component } from 'react';\r\nimport UserInterface from './UI/UserInterface'\r\nimport Canvas from './canvas/Canvas'\r\nimport Historybar from './history/Historybar'\r\nimport Historyselector from './history/Historyselector'\r\nimport Button from './history/Button'\r\nimport Topbar from './Topbar'\r\nimport { connect } from 'react-redux';\r\n\r\nclass App extends Component {\r\n  state = {\r\n    History: 0\r\n  }\r\n\r\n  setHistory(val){\r\n    this.setState({\r\n      History: val,\r\n      Historyoverlay: false\r\n    })\r\n  }\r\n\r\n  componentDidMount(){\r\n    var props = this.props;\r\n    document.addEventListener('keydown', this.keyDownHandler.bind(this))\r\n  }\r\n\r\n  keyDownHandler(event){\r\n    if (event.ctrlKey && event.key === 'z') {\r\n      this.props.undo()\r\n    }\r\n    else if (event.ctrlKey && event.key === 'y') {\r\n      this.props.redo()\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id='appcontainer'>\r\n        <Topbar/>\r\n        {this.state.History === '2' &&\r\n          <div id=\"button\">\r\n            <Button />\r\n          </div>}\r\n        {this.state.History === '1' &&\r\n          <div id=\"historybar\">\r\n            <Historybar/>\r\n          </div>\r\n        }\r\n        <div id=\"topcontainer\">\r\n          <Historyselector setHistory={this.setHistory.bind(this)}/>\r\n          {(this.state.History === 0 || this.state.History === '0') && \r\n          <button id=\"buttonUndo\" onClick={this.props.undo}>\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 18 18\" version=\"1.1\" x=\"0px\" y=\"0px\"><title>undo</title><desc>Created with Sketch.</desc><g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\"><g transform=\"translate(-5.000000, -5.000000)\" fill=\"white\"><path d=\"M6.68026306,11 L10.5,15.3357608 L9.8637811,16 L5,10.5 L9.86412375,5 L10.4994224,5.61683991 L6.67592819,10 L16.5,10 C20.0898509,10 23,12.9101491 23,16.5 C23,20.0898509 20.0898509,23 16.5,23 L10,23 L10,22 L16.5,22 C19.5375661,22 22,19.5375661 22,16.5 C22,13.4624339 19.5375661,11 16.5,11 L6.68026306,11 Z\"/></g></g><text x=\"0\" y=\"33\" fill=\"#000000\" font-size=\"5px\" font-weight=\"bold\" font-family=\"'Helvetica Neue', Helvetica, Arial-Unicode, Arial, Sans-serif\">Created by xwoodhillx</text><text x=\"0\" y=\"38\" fill=\"#000000\" font-size=\"5px\" font-weight=\"bold\" font-family=\"'Helvetica Neue', Helvetica, Arial-Unicode, Arial, Sans-serif\">from the Noun Project</text></svg>\r\n          </button>}\r\n          {(this.state.History === 0 || this.state.History === '0') && \r\n          <button id=\"buttonRedo\" onClick={this.props.redo}>\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" style={{transform: \"scale(-1,1)\"}} viewBox=\"0 0 18 18\" version=\"1.1\" x=\"0px\" y=\"0px\"><title>undo</title><desc>Created with Sketch.</desc><g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\"><g transform=\"translate(-5.000000, -5.000000)\" fill=\"white\"><path d=\"M6.68026306,11 L10.5,15.3357608 L9.8637811,16 L5,10.5 L9.86412375,5 L10.4994224,5.61683991 L6.67592819,10 L16.5,10 C20.0898509,10 23,12.9101491 23,16.5 C23,20.0898509 20.0898509,23 16.5,23 L10,23 L10,22 L16.5,22 C19.5375661,22 22,19.5375661 22,16.5 C22,13.4624339 19.5375661,11 16.5,11 L6.68026306,11 Z\"/></g></g><text x=\"0\" y=\"33\" fill=\"#000000\" font-size=\"5px\" font-weight=\"bold\" font-family=\"'Helvetica Neue', Helvetica, Arial-Unicode, Arial, Sans-serif\">Created by xwoodhillx</text><text x=\"0\" y=\"38\" fill=\"#000000\" font-size=\"5px\" font-weight=\"bold\" font-family=\"'Helvetica Neue', Helvetica, Arial-Unicode, Arial, Sans-serif\">from the Noun Project</text></svg>\r\n          </button>}\r\n          <UserInterface/>\r\n          <div id=\"drawing-canvas-container\">\r\n            <Canvas history={this.state.History}/>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    );\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    undo: () => { dispatch({type: 'UNDO' }) },\r\n    redo: () => { dispatch({type: 'REDO' }) },\r\n  }\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(App);\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}","const initState = {\r\n    traces: [],\r\n    penstate: {\r\n        color: '#000000',\r\n        alpha: 1,\r\n        point: .1,\r\n        linedash: false,\r\n        saturation: 1,\r\n        end: 0,\r\n        fill: 0,\r\n        shadow: 0,\r\n        line: 0\r\n    },\r\n    initpenstate: {\r\n        color: '#000000',\r\n        alpha: 1,\r\n        point: .1,\r\n        linedash: false,\r\n        saturation: 1,\r\n        end: 0,\r\n        fill: 0,\r\n        shadow:0,\r\n        line:0\r\n    },\r\n    t: 1,\r\n    deltaT: 0,\r\n    displaytraces: [],\r\n    uicolor: \"white\"\r\n}\r\n\r\nfunction clearTraces(traces, t) {\r\n    var i = 0;\r\n\r\n    for(; i < traces.length; i++){\r\n        if (traces[i].t <= t){\r\n\r\n        }\r\n        else{\r\n            break\r\n        }\r\n    }\r\n    return traces.slice(0,i)\r\n\r\n}\r\n\r\nfunction getPenState(traces, penstate, t){   \r\n\r\n    for(var i = 0; i < traces.length; i++){\r\n        if(traces[i].t > t){\r\n            break\r\n        }\r\n        if(traces[i].type === 'ui'){\r\n            penstate = {...penstate, ...traces[i].changes}\r\n        }\r\n    }\r\n    return penstate\r\n}\r\n\r\nconst rootReducer = (state = initState, action) => {\r\n    var newtraces\r\n    var traces\r\n    switch (action.type) {\r\n\r\n        case 'ADD_UITRACE':\r\n            var newT\r\n            if(state.deltaT === 0){\r\n                traces = state.traces;\r\n                newT = state.t + 1\r\n            }\r\n            else{\r\n                traces = clearTraces(state.traces, state.t + state.deltaT)\r\n                newT = Math.min(state.t, Math.max(state.t + state.deltaT, 0)) + 1;\r\n            }\r\n            newtraces = [...traces, {type: 'ui', changes: action.changes, trace: action.trace, t: newT}];\r\n            return {\r\n                ...state,\r\n                traces: newtraces,\r\n                t: newT,\r\n                deltaT: 0\r\n            }\r\n\r\n        case 'ADD_DRAWTRACE':\r\n            var newT\r\n            if(state.deltaT === 0){\r\n                traces = state.traces;\r\n                newT = state.t + 1\r\n            } \r\n            else{\r\n                traces = clearTraces(state.traces, state.t + state.deltaT)\r\n                newT = Math.min(state.t, Math.max(state.t + state.deltaT, 0)) + 1;\r\n            }\r\n            newtraces = [...traces, {type: 'draw', changes:null, trace: action.trace, t: newT}];\r\n            return {\r\n                ...state,\r\n                traces: newtraces,\r\n                t: newT,\r\n                deltaT: 0\r\n            }\r\n\r\n        case 'ADD_IMAGE':\r\n            var newT\r\n            if(state.deltaT === 0){\r\n                traces = state.traces;\r\n                newT = state.t + 1\r\n            } \r\n            else{\r\n                traces = clearTraces(state.traces, state.t + state.deltaT)\r\n                newT = Math.min(state.t, Math.max(state.t + state.deltaT, 0)) + 1;\r\n            }\r\n            newtraces = [...traces, {type: 'image', imgData: action.imgData, t: newT, height: action.height, width: action.width}];\r\n            return {\r\n                ...state,\r\n                traces: newtraces,\r\n                t: newT,\r\n                deltaT: 0\r\n            }\r\n        case 'ADD_IMAGETRACE':\r\n            var newT\r\n            if(state.deltaT === 0){\r\n                traces = state.traces;\r\n                newT = state.t + 1;\r\n            } \r\n            else{\r\n                traces = clearTraces(state.traces, state.t + state.deltaT)\r\n                newT = Math.min(state.t, Math.max(state.t + state.deltaT, 0)) + 1;\r\n            }\r\n            newtraces = [...traces, {type: 'imgtrace', transform: action.transform, trace: action.trace, t: newT}]\r\n            return {\r\n                ...state,\r\n                traces: newtraces,\r\n                t: newT,\r\n                deltaT: 0\r\n            }\r\n        case 'DEL_UITRACE':\r\n            newtraces = [...state.traces.filter(el => el.t !== action.t)]\r\n            var penstate = getPenState(newtraces, state.initpenstate, state.t + state.deltaT) \r\n            return {\r\n                ...state,\r\n                traces: newtraces,\r\n                penstate\r\n            }\r\n\r\n        case 'SET_PENSTATE':\r\n            return{\r\n                ...state,\r\n                penstate: {\r\n                    ...state.penstate, \r\n                    ...action.update,\r\n                }\r\n            }\r\n        case 'CHECK':\r\n            return{\r\n                ...state,\r\n                penstate:{\r\n                    ...state.penstate,\r\n                    [action.id]: !state.penstate[action.id]\r\n                }\r\n            }\r\n        case 'SET_INIT':\r\n            return {\r\n                ...state,\r\n                penstate: state.initpenstate\r\n            }\r\n\r\n        case 'ADD_DISPLAYTRACE':\r\n            if(state.displaytraces.find(el => el.t === action.t)){\r\n                return {...state}\r\n            }\r\n            else {\r\n                var newdisplaytraces = [...state.displaytraces, {t: action.t, alpha: action.alpha}]\r\n                return {\r\n                    ...state,\r\n                    displaytraces: newdisplaytraces\r\n                }\r\n            }\r\n\r\n        case 'CLR_DISPLAYTRACES':\r\n            return {\r\n                ...state,\r\n                displaytraces: []\r\n            }\r\n        case 'CLR_DISPLAYTRACE':\r\n            newtraces = [...state.displaytraces.filter(el => el.t !== action.t)]\r\n            return {\r\n                ...state,\r\n                displaytraces: newtraces\r\n            }\r\n        case 'SET_DISPLAYTRACES':\r\n            return{\r\n                ...state,\r\n                displaytraces: action.list,\r\n            }\r\n\r\n        case 'DELTA_T':\r\n            return{\r\n                ...state,\r\n                deltaT : action.deltaT\r\n            }\r\n        case 'UNDO':\r\n            var penstate = getPenState(state.traces, state.initpenstate, state.t + state.deltaT - 1) \r\n            return{\r\n                ...state,\r\n                deltaT: state.deltaT - 1,\r\n                penstate\r\n            }\r\n        case 'REDO':\r\n            var penstate = getPenState(state.traces, state.initpenstate, state.t + state.deltaT - 1) \r\n            return{\r\n                ...state,\r\n                deltaT: state.deltaT + 1,\r\n                penstate\r\n            }\r\n\r\n        default:\r\n            break;\r\n\r\n    }\r\n    \r\n    return state;\r\n}\r\n\r\nexport default rootReducer","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport { Provider } from 'react-redux'\r\nimport { createStore } from 'redux'\r\nimport rootReducer from './reducers/rootreducer'\r\n\r\nconst store = createStore(rootReducer);\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}